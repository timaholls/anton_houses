{% extends 'base.html' %}

{% block title %}CENTURY 21 - Главная{% endblock %}

{% block content %}
<div class="container">
    <section class="hero-section">
        <h1 class="hero-title">Добро пожаловать в CENTURY 21</h1>
        <p class="hero-subtitle">Найдите свой идеальный дом в лучших жилых комплексах</p>
    </section>
    <style>
    .hero-section{
        position:relative;overflow:hidden;border-radius:16px;min-height:360px;margin:12px 0 22px 0;
        background: linear-gradient(0deg, rgba(37,37,38,.35), rgba(37,37,38,.35)), url('/media/uploads/back_home.jpg') center/cover no-repeat;
        display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
    }
    .hero-title{font-size:44px;line-height:1.15;margin:0 12px 8px 12px;color:#fff;font-weight:800;letter-spacing:.4px}
    .hero-subtitle{font-size:18px;color:#f5f5f5;margin:0 12px 0 12px;opacity:.95}
    @media (max-width: 900px){
        .hero-section{min-height:280px;border-radius:12px}
        .hero-title{font-size:30px}
        .hero-subtitle{font-size:16px}
    }
    </style>

    {% if offers %}
    <section class="offers-section" id="offers">
        <div class="offers-header">
            <h2 class="section-title">Специальные предложения по ЖК</h2>
        </div>
        <div class="offers-grid">
            {% for o in offers %}
            <a href="{% url 'main:offer_detail' o.id %}" class="offer-card">
                <div class="offer-media">
                    {% if o.get_main_image and o.get_main_image.image %}
                        <img src="{{ o.get_main_image.image.url }}" alt="{{ o.title }}" loading="lazy" decoding="async">
                    {% else %}
                        <img src="/media/gallery/placeholders.png" alt="{{ o.title }}" loading="lazy" decoding="async">
                    {% endif %}
                    <span class="offer-badge-hot"><i class="fas fa-bolt"></i> Акция</span>
                </div>
                <div class="offer-content">
                    <div class="offer-head">
                        <span class="offer-chip">{{ o.residential_complex.name }}</span>
                        <h3 class="offer-title">{{ o.title }}</h3>
                    </div>
                    <p class="offer-text">{{ o.description|truncatechars:160 }}</p>
                    <div class="offer-limited">
                        <i class="far fa-clock"></i>
                        <span>
                            {% if o.expires_at %}
                                До {{ o.expires_at|date:"d.m.Y" }}
                            {% else %}
                                Временное предложение
                            {% endif %}
                        </span>
                    </div>
                    <div class="offer-actions">
                        <span class="btn btn-primary btn-small offer-cta">Подробнее об акции</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <!-- Кнопка "Посмотреть все акции" -->
        <div class="offers-more-section">
            <a href="{% url 'main:all_offers' %}" class="btn btn-secondary btn-large offers-more-btn">
                <span>Посмотреть все акции</span>
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        <style>
        .offers-section{margin:28px 0 4px 0}
        .offers-header{text-align:center;margin-bottom:12px}
        .offers-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(400px, 1fr));gap:20px;justify-items:center}
                 .offer-card{width:100%;max-width:600px;display:grid;grid-template-columns:200px 1fr;gap:16px;background:#fff;border:1px solid #efe7ce;border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);transition:box-shadow .2s ease, transform .2s ease, border-color .2s ease;text-decoration:none;color:inherit}
        .offer-card:hover{box-shadow:0 16px 36px rgba(0,0,0,.14);transform:translateY(-2px);border-color:var(--c21-gold)}
        .offer-media{position:relative;border-radius:12px;overflow:hidden;aspect-ratio:16/10;min-height:120px}
        .offer-media img{width:100%;height:100%;object-fit:cover;display:block}
        .offer-media::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.00) 40%, rgba(0,0,0,.18) 100%)}
        .offer-badge-hot{position:absolute;left:8px;top:8px;z-index:2;background:var(--c21-gold);color:var(--c21-dark);padding:4px 8px;border-radius:999px;font-weight:800;display:inline-flex;gap:4px;align-items:center;font-size:11px;box-shadow:0 4px 10px rgba(190,175,135,.35)}
        .offer-badge-hot i{font-size:11px}
        .offer-content{display:flex;flex-direction:column;justify-content:space-between;min-height:120px}
        .offer-head{display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;margin-bottom:8px}
        .offer-chip{display:inline-block;background:var(--c21-dark);color:var(--c21-gold);padding:3px 8px;border-radius:999px;font-weight:700;font-size:11px;white-space:nowrap}
        .offer-title{margin:0;font-size:16px;font-weight:800;color:#222;line-height:1.3;word-wrap:break-word;hyphens:auto}
        .offer-text{color:#444;margin:8px 0 0 0;font-size:14px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}
        .offer-limited{display:flex;align-items:center;gap:6px;color:#7b6a3e;background:#faf7ee;border:1px solid #efe7ce;border-radius:8px;padding:6px 8px;margin-top:8px;font-weight:600;font-size:12px}
        .offer-limited i{color:var(--c21-gold);font-size:12px}
        .offer-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px;justify-content:flex-start}
                 .offer-cta{flex:none;text-align:center;padding:8px 16px !important;border-radius:8px;background:linear-gradient(180deg,var(--c21-gold), var(--c21-gold-dark)) !important;color:var(--c21-dark) !important;border:none !important;box-shadow:0 4px 12px rgba(190,175,135,.45);font-size:13px;font-weight:700;min-width:140px}
         .offer-cta:hover{filter:brightness(.98);transform:translateY(-1px)}
        @media(max-width: 768px){
            .offers-grid{grid-template-columns:1fr;gap:16px}
            .offer-card{grid-template-columns:1fr;max-width:100%}
            .offer-media{aspect-ratio:16/9}
            .offer-content{min-height:auto}
            .offer-title{font-size:18px}
            .offer-text{font-size:15px}
        }
                 @media(max-width: 480px){
             .offer-card{padding:12px;gap:12px}
             .offer-title{font-size:16px}
             .offer-text{font-size:14px}
             .offer-actions{flex-direction:column;align-items:center}
             .offer-cta{flex:none;width:100%;max-width:200px}
         }
         
         /* Стили для кнопки "Посмотреть все акции" */
         .offers-more-section {
             text-align: center;
             margin-top: 32px;
         }
         
         .offers-more-btn {
             display: inline-flex;
             align-items: center;
             gap: 8px;
             padding: 16px 32px;
             border-radius: 12px;
             text-decoration: none;
             font-weight: 700;
             font-size: 16px;
             transition: all 0.2s ease;
             background: #fff;
             color: #6a5e2e;
             border: 2px solid #e8e4d5;
             box-shadow: 0 4px 12px rgba(0,0,0,.08);
         }
         
         .offers-more-btn:hover {
             background: #faf7ee;
             transform: translateY(-2px);
             box-shadow: 0 8px 16px rgba(0,0,0,.12);
         }
        </style>
    </section>
    {% endif %}

    <section class="catalog-section">
        <div class="catalog-header">
            <h2 class="section-title">9 лучших предложений для вас</h2>
        </div>

        <style>
        /* Улучшенный грид карточек */
        .home-grid{display:grid;grid-template-columns:repeat(3,minmax(260px,1fr));gap:18px}
        @media(max-width:1100px){.home-grid{grid-template-columns:repeat(2,minmax(240px,1fr))}}
        @media(max-width:720px){.home-grid{grid-template-columns:1fr}}
        /* Карточка */
        .home-property-card{background:#fff;border:1px solid #eee;border-radius:16px;overflow:hidden;text-decoration:none;color:inherit;box-shadow:0 8px 24px rgba(0,0,0,.06);transition:transform .2s ease, box-shadow .2s ease}
        .home-property-card:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(0,0,0,.12)}
        /* Ровные превью */
        .home-card-image{position:relative;aspect-ratio:16/10;overflow:hidden}
        .home-card-image img{width:100%;height:100%;object-fit:cover;display:block}
        /* Контент */
        .home-card-content{padding:12px 14px 14px 14px}
        .home-card-title{margin:0 0 6px 0;font-size:18px;font-weight:800;color:#222}
        .home-card-location{display:flex;gap:8px;align-items:center;color:#666;font-size:13px}
        .home-location-text{background:#f6f6f6;border:1px solid #eee;padding:4px 8px;border-radius:999px}
        .home-commute-time{background:#faf7ee;border:1px solid #efe7ce;color:#7b6a3e;padding:4px 8px;border-radius:999px}
        .home-card-price{margin-top:10px}
        .home-price-text{font-weight:800;color:var(--c21-gold)}
        </style>

        <div class="home-grid">
            {% for complex in complexes %}
            <a class="home-property-card" data-city="{{ complex.city }}" data-district="{{ complex.district }}" href="{% url 'main:detail' complex.id %}">
                <div class="home-card-image">
                    {% if complex.get_main_image and complex.get_main_image.image %}
                        <img src="{{ complex.get_main_image.image.url }}" alt="{{ complex.name }}" loading="lazy" decoding="async" sizes="(max-width: 900px) 100vw, 33vw">
                    {% else %}
                        <img src="/media/gallery/placeholders.png" alt="{{ complex.name }}" loading="lazy" decoding="async">
                    {% endif %}
                </div>
                
                <div class="home-card-content">
                    <div class="home-card-header">
                        <h3 class="home-card-title">{{ complex.name }}</h3>
                        <div class="home-card-location">
                            <span class="home-location-text">{{ complex.district|default:complex.city }}</span>
                            <span class="home-commute-time">{{ complex.commute_time }}</span>
                        </div>
                    </div>
                    
                    <div class="home-card-price">
                        <span class="home-price-text">от {{ complex.price_from|floatformat:1 }} млн ₽</span>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="no-complexes">
                <p>Жилые комплексы пока не добавлены</p>
            </div>
            {% endfor %}
        </div>

        <div class="catalog-footer">
            <a href="{% url 'main:catalog' %}" class="btn btn-primary btn-large">
                Перейти в каталог ЖК
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
    </section>

    {% if home_articles %}
    <section class="catalog-section">
        <div class="catalog-header">
            <h2 class="section-title">Полезные статьи</h2>
            <p class="section-subtitle">Отобранные материалы</p>
        </div>

        <div class="home-grid">
            {% for a in home_articles %}
            <a class="home-property-card" href="{{ a.get_absolute_url }}">
                <div class="home-card-image">
                    {% if a.get_main_image and a.get_main_image.image %}
                        <img src="{{ a.get_main_image.image.url }}" alt="{{ a.title }}">
                    {% else %}
                        <img src="/media/gallery/placeholders.png" alt="{{ a.title }}">
                    {% endif %}
                </div>
                <div class="home-card-content">
                    <div class="home-card-header">
                        <h3 class="home-card-title">{{ a.title }}</h3>
                        <div class="home-card-location">
                            <span class="home-location-text">{{ a.get_category_display }}</span>
                            <span class="home-commute-time">{{ a.published_date }}</span>
                        </div>
                    </div>
                    <div class="home-card-price">
                        <span class="home-price-text">{{ a.excerpt|striptags|truncatechars:90 }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        <div class="catalog-footer">
            <a href="{% url 'main:articles' %}" class="btn btn-primary btn-large">Все статьи <i class="fas fa-arrow-right"></i></a>
        </div>
    </section>
    {% endif %}

    <!-- Блок "О компании" -->
    {% if company_info %}
    <section class="about-section">
        <div class="about-header">
            <span class="about-tab">О компании</span>
            <h2 class="about-title">Мы специализируемся на продаже квартир в лучших жилых комплексах</h2>
        </div>
        
        <div class="about-content">
            <div class="about-image">
                {% if company_gallery %}
                <!-- Слайд-шоу галереи -->
                <div class="company-gallery-slider">
                    <div class="slider-container">
                        {% for gallery_item in company_gallery %}
                        <div class="slide {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}">
                            <img src="{{ gallery_item.image.url }}" alt="{{ gallery_item.title }}">
                            {% if gallery_item.description %}
                            <div class="slide-caption">
                                <h4>{{ gallery_item.title }}</h4>
                                <p>{{ gallery_item.description }}</p>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Навигационные точки -->
                    {% if company_gallery|length > 1 %}
                    <div class="slider-dots">
                        {% for gallery_item in company_gallery %}
                        <button class="dot {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}"></button>
                        {% endfor %}
                    </div>
                    
                    <!-- Кнопки навигации -->
                    <button class="slider-btn prev-btn" aria-label="Предыдущее изображение">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="slider-btn next-btn" aria-label="Следующее изображение">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    {% endif %}
                </div>
                {% else %}
                <!-- Фото основателя как fallback -->
                {% if company_info.get_main_image and company_info.get_main_image.image %}
<img src="{{ company_info.get_main_image.image.url }}" alt="{{ company_info.founder_name }}">
                {% else %}
                <img src="/media/gallery/placeholders.png" alt="{{ company_info.founder_name }}">
                {% endif %}
                {% endif %}
            </div>
            
            <div class="about-text">
                <blockquote class="about-quote">
                    {{ company_info.quote }}
                </blockquote>
                
                <div class="about-signature">
                    <div class="signature-line">{{ company_info.founder_name }}</div>
                    <div class="founder-info">
                        <span class="founder-title">{{ company_info.founder_position }}</span>
                        <span class="company-name">{{ company_info.company_name }}</span>
                    </div>
                </div>

                <div class="about-actions">
                    <a href="{% url 'main:team' %}" class="btn">
                        Наша команда
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

</div>

<style>
/* Стили для слайд-шоу галереи компании */
.company-gallery-slider {
    position: relative;
    width: 100%;
    height: 480px;
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    margin-left: 20px;
}

.slider-container {
    position: relative;
    width: 100%;
    height: 100%;
}

.slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
    display: flex;
    align-items: center;
    justify-content: center;
}

.slide.active {
    opacity: 1;
}

.slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 24px;
}

.slide-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.8));
    color: white;
    padding: 20px;
    text-align: center;
}

.slide-caption h4 {
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    font-weight: 700;
}

.slide-caption p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.9;
}

/* Навигационные точки */
.slider-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
}

.dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.5);
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
}

.dot.active {
    background: var(--c21-gold);
    border-color: var(--c21-gold);
}

.dot:hover {
    background: rgba(255,255,255,0.3);
}

/* Кнопки навигации */
.slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.5);
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
}

.slider-btn:hover {
    background: var(--c21-gold);
    color: var(--c21-dark);
}

.prev-btn {
    left: 20px;
}

.next-btn {
    right: 20px;
}

/* Адаптивность для слайд-шоу */
@media (max-width: 768px) {
    .company-gallery-slider {
        height: 300px;
        border-radius: 16px;
        margin-left: 10px;
    }
    
    .slider-btn {
        width: 35px;
        height: 35px;
    }
    
    .prev-btn {
        left: 10px;
    }
    
    .next-btn {
        right: 10px;
    }
    
    .slide-caption {
        padding: 15px;
    }
    
    .slide-caption h4 {
        font-size: 1rem;
    }
    
    .slide-caption p {
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .company-gallery-slider {
        height: 250px;
        border-radius: 12px;
        margin-left: 0;
    }
    
    .slide img {
        border-radius: 12px;
    }
    
    .slider-btn {
        width: 30px;
        height: 30px;
    }
    
    .prev-btn {
        left: 8px;
    }
    
    .next-btn {
        right: 8px;
    }
    
    .slide-caption {
        padding: 12px;
    }
    
    .slide-caption h4 {
        font-size: 0.9rem;
    }
    
    .slide-caption p {
        font-size: 0.7rem;
    }
}
</style>

<script>
// Навигация теперь через обычные ссылки <a>

// Эффект тени для sticky шапки при прокрутке
window.addEventListener('scroll', function() {
    const header = document.querySelector('.main-header');
    if (window.scrollY > 10) {
        header.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
    } else {
        header.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.05)';
    }
});



// Дополнительные эффекты для блока "О компании"
document.addEventListener('DOMContentLoaded', function() {
    // Инициализация слайд-шоу галереи
    const slider = document.querySelector('.company-gallery-slider');
    if (slider) {
        const slides = slider.querySelectorAll('.slide');
        const dots = slider.querySelectorAll('.dot');
        const prevBtn = slider.querySelector('.prev-btn');
        const nextBtn = slider.querySelector('.next-btn');
        
        let currentSlide = 0;
        let slideInterval;
        
        function showSlide(index) {
            // Скрываем все слайды
            slides.forEach(slide => slide.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));
            
            // Показываем текущий слайд
            slides[index].classList.add('active');
            dots[index].classList.add('active');
            
            currentSlide = index;
        }
        
        function nextSlide() {
            const nextIndex = (currentSlide + 1) % slides.length;
            showSlide(nextIndex);
        }
        
        function prevSlide() {
            const prevIndex = (currentSlide - 1 + slides.length) % slides.length;
            showSlide(prevIndex);
        }
        
        function startAutoSlide() {
            slideInterval = setInterval(nextSlide, 5000); // 5 секунд
        }
        
        function stopAutoSlide() {
            clearInterval(slideInterval);
        }
        
        // Обработчики для кнопок
        if (nextBtn) {
            nextBtn.addEventListener('click', function() {
                stopAutoSlide();
                nextSlide();
                startAutoSlide();
            });
        }
        
        if (prevBtn) {
            prevBtn.addEventListener('click', function() {
                stopAutoSlide();
                prevSlide();
                startAutoSlide();
            });
        }
        
        // Обработчики для точек
        dots.forEach((dot, index) => {
            dot.addEventListener('click', function() {
                stopAutoSlide();
                showSlide(index);
                startAutoSlide();
            });
        });
        
        // Остановка автопереключения при наведении
        slider.addEventListener('mouseenter', stopAutoSlide);
        slider.addEventListener('mouseleave', startAutoSlide);
        
        // Запускаем автопереключение
        if (slides.length > 1) {
            startAutoSlide();
        }
    }
    
    const aboutSection = document.querySelector('.about-section');
    const aboutImage = document.querySelector('.about-image');
    const aboutQuote = document.querySelector('.about-quote');
    
    if (aboutSection && aboutImage && aboutQuote) {
        let isTypewriterActive = false;
        
        // Анимация появления цитаты при наведении на изображение
        aboutImage.addEventListener('mouseenter', function() {
            if (!isTypewriterActive) {
                aboutQuote.style.transform = 'scale(1.02)';
                aboutQuote.style.transition = 'transform 0.3s ease';
            }
        });
        
        aboutImage.addEventListener('mouseleave', function() {
            if (!isTypewriterActive) {
                aboutQuote.style.transform = 'scale(1)';
            }
        });
        
        // Эффект печатной машинки для цитаты
        const quoteText = aboutQuote.textContent.trim();
        aboutQuote.textContent = '';
        let i = 0;
        
        function typeWriter() {
            if (i < quoteText.length) {
                aboutQuote.textContent += quoteText.charAt(i);
                i++;
                setTimeout(typeWriter, 30);
            } else {
                // Завершаем анимацию печатной машинки
                isTypewriterActive = false;
                // Восстанавливаем возможность hover эффектов
                aboutQuote.style.transition = 'transform 0.3s ease';
            }
        }
        
        // Запускаем анимацию печатной машинки при появлении в области видимости
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting && !isTypewriterActive) {
                    isTypewriterActive = true;
                    // Фиксируем изображение во время анимации печатной машинки
                    aboutImage.style.transform = 'perspective(1000px) rotateY(-5deg)';
                    aboutImage.style.transition = 'transform 0.3s ease';
                    
                    setTimeout(typeWriter, 1000);
                    observer.unobserve(entry.target);
                }
            });
        });
        
        observer.observe(aboutSection);
        
        // Легкий эффект параллакса только после завершения анимации печатной машинки
        window.addEventListener('scroll', function() {
            if (!isTypewriterActive) {
                const scrolled = window.pageYOffset;
                const aboutSectionTop = aboutSection.offsetTop;
                const aboutSectionHeight = aboutSection.offsetHeight;
                
                if (scrolled >= aboutSectionTop - window.innerHeight && 
                    scrolled <= aboutSectionTop + aboutSectionHeight) {
                    const rate = (scrolled - aboutSectionTop) * 0.1;
                    aboutImage.style.transform = `perspective(1000px) rotateY(-5deg) translateY(${rate}px)`;
                }
            }
        });
    }
    

});
</script>
{% endblock %} 