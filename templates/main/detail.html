{% extends 'base.html' %}

{% block title %}{{ complex.name }} - –ê–Ω—Ç–æ–Ω –•–∞—É—Å{% endblock %}

{% block extra_css %}
<style>
	/* –°—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∫–≤–∞—Ä—Ç–∏—Ä */
	.compact-card-image-gallery {
		position: relative;
		width: 100%;
		height: 280px;
		overflow: hidden;
		border-radius: 12px 12px 0 0;
		background: #f9fafb;
	}

	.compact-card-image-gallery .gallery-image {
		width: 100%;
		height: 100%;
		object-fit: contain;
		transition: opacity 0.3s ease;
	}

	.gallery-nav {
		position: absolute;
		top: 50%;
		transform: translateY(-50%);
		background: rgba(0, 0, 0, 0.6);
		color: white;
		border: none;
		width: 36px;
		height: 36px;
		border-radius: 50%;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.3s ease;
		z-index: 10;
		opacity: 0;
	}

	.compact-card-image-gallery:hover .gallery-nav {
		opacity: 1;
	}

	.gallery-nav:hover {
		background: rgba(0, 0, 0, 0.8);
		transform: translateY(-50%) scale(1.1);
	}

	/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–≤–∞—Ä—Ç–∏—Ä—ã */
	.apartment-detail-link:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(190, 175, 135, 0.4);
		text-decoration: none;
		color: #1f2937;
	}

	.gallery-prev {
		left: 10px;
	}

	.gallery-next {
		right: 10px;
	}

	.gallery-dots {
		position: absolute;
		bottom: 10px;
		left: 50%;
		transform: translateX(-50%);
		display: flex;
		gap: 6px;
		z-index: 10;
	}

	.gallery-dots .dot {
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background: rgba(255, 255, 255, 0.5);
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.gallery-dots .dot.active {
		background: rgba(255, 255, 255, 1);
		width: 24px;
		border-radius: 4px;
	}

	.gallery-dots .dot:hover {
		background: rgba(255, 255, 255, 0.8);
	}

	/* –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
	.favorite-btn-detail {
		width: 48px;
		height: 48px;
		border-radius: 50%;
		background: rgba(255, 255, 255, 0.95);
		border: 2px solid rgba(255, 255, 255, 0.3);
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		transition: all 0.2s ease;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		flex-shrink: 0;
	}

	.favorite-btn-detail:hover {
		background: rgba(255, 255, 255, 1);
		transform: scale(1.1);
		box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
	}

	.favorite-btn-detail i {
		font-size: 22px;
		color: #666;
		transition: all 0.2s ease;
	}

	.favorite-btn-detail.favorite-active i,
	.favorite-btn-detail:hover i {
		color: #e74c3c;
	}

	.favorite-btn-detail.favorite-active {
		background: rgba(231, 76, 60, 0.15);
		border-color: rgba(231, 76, 60, 0.3);
	}

	/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞ —Å–ø—Ä–∞–≤–∞ */
	.agent-sidebar {
		min-width: 0;
	}

	.agent-card {
		background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%) !important;
		border: 1px solid rgba(255, 255, 255, 0.1) !important;
	}

	.agent-action-btn {
		width: 100%;
		cursor: pointer;
	}

	.agent-action-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
		opacity: 0.95;
	}

	.agent-action-btn.agent-call-btn:hover {
		background: #059669 !important;
		box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5) !important;
	}

	.agent-action-btn.agent-whatsapp-btn:hover {
		background: #128C7E !important;
		box-shadow: 0 4px 12px rgba(37, 211, 102, 0.5) !important;
	}

	.hero-image-wrapper {
		border-radius: 12px;
		overflow: hidden;
	}

	/* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
	@media (max-width: 1024px) {
		.detail-hero {
			grid-template-columns: 1fr !important;
			gap: 20px !important;
		}

		/* –ê–≥–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ñ–æ—Ç–æ (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ HTML) */

		.agent-card {
			max-width: 100%;
		}
	}

	@media (max-width: 768px) {
		.compact-card-image-gallery {
			height: 240px;
		}

		.gallery-nav {
			opacity: 1;
			width: 32px;
			height: 32px;
		}

		.hero-image-wrapper .hero-image {
			height: 400px !important;
		}

		.agent-actions {
			gap: 10px !important;
		}

		.agent-action-btn {
			padding: 10px 16px !important;
			font-size: 13px !important;
		}
	}
</style>
{% endblock %}

{% block content %}
<div class="detail-container">
	<!-- Hero —Å–µ–∫—Ü–∏—è —Å –≥–ª–∞–≤–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –∞–≥–µ–Ω—Ç–æ–º -->
	<div class="detail-hero" style="display: grid; grid-template-columns: 1fr 380px; gap: 24px; margin-bottom: 40px;">
		<!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
		<div class="hero-image-wrapper" style="position: relative;">
			<div class="hero-image" id="heroGallery" style="height: 500px;">
				{% if is_mongodb and complex.photos %}
				{% for photo in complex.photos %}
				<img src="{{ photo }}" alt="{{ complex.name }}" class="hero-main-image"
					style="{% if not forloop.first %}display:none;{% endif %}"
					data-photo-index="{{ forloop.counter0 }}">
				{% endfor %}
				{% elif complex.get_main_image and complex.get_main_image.image %}
				<img src="{{ complex.get_main_image.image.url }}" alt="{{ complex.name }}" class="hero-main-image">
				{% else %}
				<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ complex.name }}" class="hero-main-image">
				{% endif %}

				<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –ø–æ–≤–µ—Ä—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
				<div class="hero-info-overlay"
					style="background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, transparent 100%);">
					<h1 class="complex-name"
						style="position: absolute; bottom: 20px; left: 20px; color: white; font-size: 24px; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.8); z-index: 5;">
						{{ complex.name }}
					</h1>
					{% if is_mongodb and complex.photos %}
					<div class="photo-counter"
						style="position:absolute; bottom:20px; right:20px; background:rgba(0,0,0,0.6); color:#fff; padding:8px 16px; border-radius:20px; font-size:14px; z-index: 5;">
						<span id="currentPhotoIndex">1</span> / {{ complex.photos|length }}
					</div>
					{% endif %}
				</div>
			</div>
			<!-- –ë–æ–∫–æ–≤—ã–µ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ -->
			{% if is_mongodb and complex.photos|length > 1 %}
			<div class="hero-photo-nav"
				style="position:absolute; top:50%; left:0; right:0; display:flex; justify-content:space-between; transform:translateY(-50%); pointer-events:none; padding:0 8px;">
				<button class="photo-nav-btn prev" onclick="changeHeroPhoto(-1)"
					style="pointer-events:auto; background:rgba(0,0,0,0.6); border:none; color:#fff; width:44px; height:44px; border-radius:999px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;"><i
						class="fas fa-chevron-left"></i></button>
				<button class="photo-nav-btn next" onclick="changeHeroPhoto(1)"
					style="pointer-events:auto; background:rgba(0,0,0,0.6); border:none; color:#fff; width:44px; height:44px; border-radius:999px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s;"><i
						class="fas fa-chevron-right"></i></button>
			</div>
			{% endif %}
		</div>

		<!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–µ -->
		<div class="agent-sidebar" style="display: flex; flex-direction: column;">
			<div class="agent-card"
				style="background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%); border-radius: 12px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 20px; height: fit-content; border: 1px solid rgba(255, 255, 255, 0.1);">
				<h2 class="agent-title"
					style="font-size: 18px; font-weight: 700; color: #ffffff; margin: 0; margin-bottom: 16px;">
					–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç
				</h2>
				
				<!-- –§–æ—Ç–æ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–µ -->
				<div class="agent-profile"
					style="display: flex; flex-direction: column; align-items: center; gap: 12px;">
					<div class="agent-photo-wrapper"
						style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; background: linear-gradient(135deg, #8b7355, #a0856b); display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 2px solid rgba(255, 255, 255, 0.2);">
						{% if agent %}
							{% if agent.images and agent.images.0 %}
						<img src="{{ agent.images.0 }}"
							alt="{% if agent.full_name %}{{ agent.full_name }}{% else %}–ê–≥–µ–Ω—Ç{% endif %}"
									style="width: 100%; height: 100%; object-fit: cover;">
							{% elif agent.photo %}
						<img src="{{ agent.photo }}"
							alt="{% if agent.full_name %}{{ agent.full_name }}{% else %}–ê–≥–µ–Ω—Ç{% endif %}"
									style="width: 100%; height: 100%; object-fit: cover;">
							{% else %}
								<i class="fas fa-user" style="color: #ffffff; font-size: 32px;"></i>
							{% endif %}
						{% else %}
							<i class="fas fa-user" style="color: #ffffff; font-size: 32px;"></i>
						{% endif %}
					</div>
					<div class="agent-info" style="text-align: center;">
						<div style="font-size: 18px; font-weight: 700; color: #ffffff; margin-bottom: 4px;">
							{% if agent %}
							{{ agent.full_name }}
							{% else %}
							{{ complex.developer|default:"–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫" }}
							{% endif %}
						</div>
						<div style="font-size: 13px; color: #e5e5e5; font-weight: 500;">
							{% if agent %}
							–†–∏–µ–ª—Ç–æ—Ä
							{% else %}
							–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫
							{% endif %}
						</div>
					</div>
				</div>

				<!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
				<div class="agent-actions" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
					{% if agent %}
					<a href="{% url 'main:employee_detail' agent.id %}" class="agent-action-btn"
						style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: linear-gradient(135deg, #8b7355, #a0856b); color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(139,115,85,0.3);">
						<i class="fas fa-user-tie" style="font-size: 16px;"></i>
						<span>–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∞–≥–µ–Ω—Ç–µ</span>
					</a>
					{% endif %}

					<a href="#mortgage" class="agent-action-btn"
						style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: linear-gradient(135deg, #8b7355, #a0856b); color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(139,115,85,0.3);">
						<i class="fas fa-calculator" style="font-size: 16px;"></i>
						<span>–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–ø–æ—Ç–µ–∫—É</span>
					</a>

					<a href="tel:{% if agent and agent.phone %}{{ agent.phone }}{% else %}+78001234567{% endif %}"
						class="agent-action-btn agent-call-btn"
						style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: #10b981; color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(16,185,129,0.3);">
						<i class="fas fa-phone" style="font-size: 16px;"></i>
						<span>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</span>
					</a>

					<a href="https://wa.me/{% if agent and agent.phone %}{% with phone=agent.phone|cut:' '|cut:'-'|cut:'('|cut:')'|cut:'+' %}{% if phone|slice:':1' == '8' %}7{{ phone|slice:'1:' }}{% elif phone|slice:':1' == '7' %}{{ phone }}{% else %}7{{ phone }}{% endif %}{% endwith %}{% else %}79001234567{% endif %}"
						target="_blank" rel="noopener noreferrer" class="agent-action-btn agent-whatsapp-btn"
						style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 20px; background: #25D366; color: #ffffff; text-decoration: none; border-radius: 10px; font-weight: 600; font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(37,211,102,0.3);">
						<i class="fab fa-whatsapp" style="font-size: 16px;"></i>
						<span>–ù–∞–ø–∏—Å–∞—Ç—å</span>
					</a>
				</div>
			</div>
		</div>
	</div>

	<!-- –û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ -->
	{% if is_secondary and complex.description %}
	<div class="detail-description"
		style="margin: 32px 0; padding: 24px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
		<h2 style="font-size: 24px; font-weight: 600; margin-bottom: 16px; color: #1e293b;">
			–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
		</h2>
		<div style="font-size: 16px; line-height: 1.6; color: #475569; white-space: pre-line;">
			{{ complex.description|safe }}
		</div>
	</div>
	{% endif %}

	{# –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤—Ç–æ—Ä–∏—á–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ #}
	{% if is_secondary %}
	<div class="secondary-characteristics-block"
		style="margin: 32px 0; padding: 28px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
		<h2 class="section-title"
			style="font-size: 28px; font-weight: 700; color: var(--c21-dark); margin-bottom: 20px; border-bottom: 3px solid var(--c21-gold); padding-bottom: 12px; display: inline-block;">
			–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—ä–µ–∫—Ç–∞</h2>

		<div class="secondary-chars-grid"
			style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 24px;">
			{# –ê–¥—Ä–µ—Å #}
			{% if complex.address or complex.street %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-map-marker-alt" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–ê–¥—Ä–µ—Å</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">
						{% if complex.address %}{{ complex.address }}{% else %}{{ complex.street }}{% endif %}
					</div>
				</div>
			</div>
			{% endif %}

			{# –¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ #}
			{% if complex.house_type %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-home" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">
						{% if complex.house_type == 'apartment' %}–ö–≤–∞—Ä—Ç–∏—Ä–∞
						{% elif complex.house_type == 'house' %}–ß–∞—Å—Ç–Ω—ã–π –¥–æ–º
						{% elif complex.house_type == 'cottage' %}–ö–æ—Ç—Ç–µ–¥–∂
						{% elif complex.house_type == 'townhouse' %}–¢–∞—É–Ω—Ö–∞—É—Å
						{% elif complex.house_type == 'commercial' %}–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ
						{% else %}{{ complex.house_type }}{% endif %}
					</div>
				</div>
			</div>
			{% endif %}

			{# –ü–ª–æ—â–∞–¥—å #}
			{% if complex.area %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-expand-arrows-alt" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–ü–ª–æ—â–∞–¥—å</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">{{ complex.area }}
						–º¬≤</div>
				</div>
			</div>
			{% endif %}

			{# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç #}
			{% if complex.rooms %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-bed" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">{{ complex.rooms
						}}-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</div>
				</div>
			</div>
			{% endif %}

			{# –¶–µ–Ω–∞ #}
			{% if complex.price %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-ruble-sign" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–¶–µ–Ω–∞</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">{{ complex.price|floatformat:0 }} ‚ÇΩ</div>
				</div>
			</div>
			{% endif %}

			{# –í—Ä–µ–º—è –¥–æ —Ü–µ–Ω—Ç—Ä–∞ #}
			{% if complex.commute_time %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-clock" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–í—Ä–µ–º—è –¥–æ —Ü–µ–Ω—Ç—Ä–∞</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">{{ complex.commute_time }}</div>
				</div>
			</div>
			{% endif %}

			{# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π #}
			{% if complex.total_floors %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-building" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–≠—Ç–∞–∂–Ω–æ—Å—Ç—å</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">{{ complex.total_floors }} —ç—Ç–∞–∂{{ complex.total_floors|pluralize:"–µ–π,–∞,–µ–π" }}</div>
				</div>
			</div>
			{% endif %}

			{# –û—Ç–¥–µ–ª–∫–∞ #}
			{% if complex.finishing %}
			<div class="secondary-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-paint-brush" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div style="font-size: 14px; color: #64748b; margin-bottom: 4px;">–û—Ç–¥–µ–ª–∫–∞</div>
					<div style="font-size: 16px; font-weight: 600; color: #1e293b; line-height: 1.4;">
						{% if complex.finishing == 'without' %}–ë–µ–∑ –æ—Ç–¥–µ–ª–∫–∏
						{% elif complex.finishing == 'rough' %}–ß–µ—Ä–Ω–æ–≤–∞—è –æ—Ç–¥–µ–ª–∫–∞
						{% elif complex.finishing == 'white_box' %}–ë–µ–ª–∞—è –∫–æ—Ä–æ–±–∫–∞
						{% elif complex.finishing == 'full' %}–ü–æ–ª–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞
						{% elif complex.finishing == 'designer' %}–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∞—è –æ—Ç–¥–µ–ª–∫–∞
						{% else %}{{ complex.finishing }}{% endif %}
					</div>
				</div>
			</div>
			{% endif %}
		</div>
	</div>
	{% endif %}

	{# –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ #}
	{% load main_extras %}
	{% if is_mongodb and complex.parameters and not is_secondary %}
	<div class="main-characteristics-block"
		style="margin: 32px 0; padding: 28px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
		<h2 class="section-title"
			style="font-size: 28px; font-weight: 700; color: var(--c21-dark); margin-bottom: 20px; border-bottom: 3px solid var(--c21-gold); padding-bottom: 12px; display: inline-block;">
			–û –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ</h2>

		<div class="main-chars-grid"
			style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 24px;">
			{# –ê–¥—Ä–µ—Å #}
			{% if complex.address %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-map-marker-alt" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–ê–¥—Ä–µ—Å</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ complex.address }}</div>
				</div>
			</div>
			{% endif %}

			{# –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –≤ –∫—Ä–∞—Å–∏–≤–æ–º –≤–∏–¥–µ #}
			{% for key, value in complex.parameters.items %}
			{% if value and value != '' and value != 'None' %}
			{# –°—Ä–æ–∫ —Å–¥–∞—á–∏ #}
			{% if '–°—Ä–æ–∫' in key and '—Å–¥–∞—á–∏' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-calendar" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–°—Ä–æ–∫ —Å–¥–∞—á–∏</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –ö–ª–∞—Å—Å –∂–∏–ª—å—è #}
			{% if '–ö–ª–∞—Å—Å' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-star" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–ö–ª–∞—Å—Å –∂–∏–ª—å—è</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –¢–∏–ø –∂–∏–ª—å—è #}
			{% if '–¢–∏–ø' in key and '–∂–∏–ª—å—è' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-home" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–¢–∏–ø –∂–∏–ª—å—è</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –û—Ç–¥–µ–ª–∫–∞ #}
			{% if '–û—Ç–¥–µ–ª–∫–∞' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-paint-roller" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–û—Ç–¥–µ–ª–∫–∞</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –≠—Ç–∞–∂–Ω–æ—Å—Ç—å #}
			{% if '–≠—Ç–∞–∂–Ω–æ—Å—Ç—å' in key or '—ç—Ç–∞–∂' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-building" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–≠—Ç–∞–∂–Ω–æ—Å—Ç—å</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –¢–∏–ø –¥–æ–º–∞ #}
			{% if '–¥–æ–º–∞' in key and '–¢–∏–ø' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-warehouse" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–¢–∏–ø –¥–æ–º–∞</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}

			{# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–ø—É—Å–æ–≤ #}
			{% if '–∫–æ—Ä–ø—É—Å–æ–≤' in key or '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ' in key %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-city" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–ø—É—Å–æ–≤</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ value }}</div>
				</div>
			</div>
			{% endif %}
			{% endif %}
			{% endfor %}

			{# –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ—Ä–ø—É—Å–∞—Ö –≤ parameters, –Ω–æ –µ—Å—Ç—å –≤ korpuses #}
			{% if complex.korpuses and not complex.parameters.items|length %}
			<div class="main-char-item"
				style="display: flex; align-items: flex-start; gap: 14px; padding: 16px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--c21-gold); transition: all 0.3s;">
				<div
					style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--c21-gold), var(--c21-gold-dark)); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
					<i class="fas fa-city" style="color: var(--c21-dark); font-size: 18px;"></i>
				</div>
				<div style="flex: 1;">
					<div
						style="font-size: 13px; color: #64748b; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–ø—É—Å–æ–≤</div>
					<div style="font-size: 16px; color: #1e293b; font-weight: 700; line-height: 1.4;">{{ complex.korpuses|length }}</div>
				</div>
			</div>
			{% endif %}
		</div>
	</div>

	<style>
		.main-char-item:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
			background: #ffffff !important;
		}

		/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –∞–≥–µ–Ω—Ç–∞ */
		.agent-info-section:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
			background: #ffffff !important;
		}

		.action-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
		}

		.mortgage-btn:hover {
			box-shadow: 0 8px 20px rgba(190, 175, 135, 0.5);
		}

		.agent-btn:hover {
			background: var(--c21-gold) !important;
			color: var(--c21-dark) !important;
			border-color: var(--c21-gold-dark) !important;
		}

		.phone-btn:hover {
			border-color: #10b981 !important;
			background: #f0fdf4 !important;
		}

		/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
		@media (max-width: 768px) {
			.agent-info-grid {
				grid-template-columns: 1fr !important;
				gap: 16px !important;
			}

			.agent-info-section {
				flex-direction: column !important;
				text-align: center !important;
				gap: 12px !important;
				padding: 12px !important;
			}

			.action-buttons-section {
				gap: 8px !important;
				justify-content: center !important;
			}

			.action-btn {
				padding: 10px 16px !important;
				font-size: 13px !important;
			}
		}
	</style>
	{% endif %}

	{# –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ —Å—Ç–∏–ª–µ –±—É–¥—É—â–∏—Ö –ñ–ö #}
	{% if is_mongodb and complex.parameters %}
	<div class="detailed-characteristics-section" style="margin: 32px 0;">
		<h2 class="section-title"
			style="font-size: 28px; font-weight: 700; color: var(--c21-dark); margin-bottom: 16px;">–î–µ—Ç–∞–ª—å–Ω—ã–µ
			—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h2>

		{# –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å —Å–ª–æ–≤–∞—Ä—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–∫ –∞–∫–∫—É—Ä–∞—Ç–Ω—É—é —Å–µ—Ç–∫—É #}
		<div class="characteristics-category" style="margin-bottom: 32px;">
			<h3 class="category-title"
				style="font-size: 20px; font-weight: 700; color: var(--c21-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--c21-gold);">
				–û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
			<div class="characteristics-grid-detailed"
				style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px;">
				{% for key, value in complex.parameters.items %}
				{% if value and value != '' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">{{ key }}
					</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ value }}</div>
				</div>
				{% endif %}
				{% endfor %}
			</div>
		</div>

		{# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏: —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –∫–ª—é—á–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç #}
		{% with params=complex.parameters %}
		{% if params|has_key:'–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏' or params|has_key:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç—Å–∫–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' or params|has_key:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫' %}
		<div class="characteristics-category" style="margin-bottom: 32px;">
			<h3 class="category-title"
				style="font-size: 20px; font-weight: 700; color: var(--c21-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--c21-gold);">
				–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–≤–æ—Ä–∞</h3>
			<div class="characteristics-grid-detailed"
				style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px;">
				{% if params|get_item:'–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">
						–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ –¥–æ—Ä–æ–∂–∫–∏' }}</div>
				</div>
				{% endif %}
				{% if params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç—Å–∫–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç—Å–∫–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç—Å–∫–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' }}</div>
				</div>
				{% endif %}
				{% if params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫' }}</div>
				</div>
				{% endif %}
			</div>
		</div>
		{% endif %}

		{% if params|has_key:'–ù–∞–ª–∏—á–∏–µ –ø–∞–Ω–¥—É—Å–∞' or params|has_key:'–ù–∞–ª–∏—á–∏–µ –ø–æ–Ω–∏–∂–∞—é—â–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' %}
		<div class="characteristics-category" style="margin-bottom: 32px;">
			<h3 class="category-title"
				style="font-size: 20px; font-weight: 700; color: var(--c21-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--c21-gold);">
				–î–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ä–µ–¥–∞</h3>
			<div class="characteristics-grid-detailed"
				style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px;">
				{% if params|get_item:'–ù–∞–ª–∏—á–∏–µ –ø–∞–Ω–¥—É—Å–∞' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">–ù–∞–ª–∏—á–∏–µ
						–ø–∞–Ω–¥—É—Å–∞</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ù–∞–ª–∏—á–∏–µ –ø–∞–Ω–¥—É—Å–∞' }}</div>
				</div>
				{% endif %}
				{% if params|get_item:'–ù–∞–ª–∏—á–∏–µ –ø–æ–Ω–∏–∂–∞—é—â–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">–ù–∞–ª–∏—á–∏–µ
						–ø–æ–Ω–∏–∂–∞—é—â–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ù–∞–ª–∏—á–∏–µ –ø–æ–Ω–∏–∂–∞—é—â–∏—Ö –ø–ª–æ—â–∞–¥–æ–∫' }}</div>
				</div>
				{% endif %}
			</div>
		</div>
		{% endif %}

		{% if params|has_key:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—ä–µ–∑–¥–æ–≤' or params|has_key:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏—Ö –ª–∏—Ñ—Ç–æ–≤' %}
		<div class="characteristics-category" style="margin-bottom: 0;">
			<h3 class="category-title"
				style="font-size: 20px; font-weight: 700; color: var(--c21-dark); margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--c21-gold);">
				–õ–∏—Ñ—Ç—ã –∏ –ø–æ–¥—ä–µ–∑–¥—ã</h3>
			<div class="characteristics-grid-detailed"
				style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px;">
				{% if params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—ä–µ–∑–¥–æ–≤' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—ä–µ–∑–¥–æ–≤</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—ä–µ–∑–¥–æ–≤' }}</div>
				</div>
				{% endif %}
				{% if params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏—Ö –ª–∏—Ñ—Ç–æ–≤' %}
				<div class="characteristic-detail-item"
					style="background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:12px 14px;">
					<div class="characteristic-detail-label"
						style="font-size:12px; color:#7f8c8d; text-transform:uppercase; letter-spacing:.02em;">
						–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏—Ö –ª–∏—Ñ—Ç–æ–≤</div>
					<div class="characteristic-detail-value"
						style="font-size:15px; font-weight:700; color:#2c3e50; margin-top:6px;">{{ params|get_item:'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä—Å–∫–∏—Ö –ª–∏—Ñ—Ç–æ–≤' }}</div>
				</div>
				{% endif %}
			</div>
		</div>
		{% endif %}
		{% endwith %}
	</div>
	{% endif %}

	<!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä –∏–∑ MongoDB -->
{% if not is_secondary and is_mongodb %}
	<div class="detail-apartments" style="margin: 32px 0;">
		<h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">–í–∞—Ä–∏–∞–Ω—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä</h2>

	{% if complex.apartment_variants %}
		<!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø–∞–º (—Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ) -->
		<div class="apartment-types-filter" style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
			{% for type in complex.apartment_types %}
			<button class="apt-filter-btn {% if forloop.first %}active{% endif %}" data-type="{{ type }}"
				onclick="filterApartmentsByType('{{ type }}')"
				style="padding: 10px 20px; border: 2px solid {% if forloop.first %}#2563eb{% else %}#e5e7eb{% endif %}; background: {% if forloop.first %}#2563eb{% else %}white{% endif %}; color: {% if forloop.first %}white{% else %}#374151{% endif %}; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
				{% if type == '–°—Ç—É–¥–∏—è' %}–°—Ç—É–¥–∏—è{% else %}{{type}}-–∫–æ–º–Ω{% endif %}
			</button>
			{% endfor %}
		</div>

		<!-- –°–ø–∏—Å–æ–∫ –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ —Ç–∏–ø–∞–º —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π -->
		{% for apt_type in complex.apartment_types %}
		<div class="apartments-type-section" data-type-section="{{ apt_type }}"
			style="display: {% if forloop.first %}block{% else %}none{% endif %};">
			<div class="apartments-grid"
				style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
				{% with apartments=complex.apartment_variants_grouped|get_item:apt_type %}
				{% if apartments %}
				{% for apt in apartments %}
				<div class="apartment-card" data-apt-type="{{ apt.type }}" data-apt-index="{{ forloop.counter0 }}"
					style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.08); display: {% if forloop.counter0 < 6 %}block{% else %}none{% endif %};">
					<!-- –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ -->
					<div class="compact-card-image-gallery" onclick="openAptGalleryFromCard(this)">
						<button class="favorite-btn" data-favorite-complex-id="{{ complex.id }}"
							data-favorite-apartment-id="{{ apt.id }}"
							onclick="event.stopPropagation(); toggleApartmentFavoriteHandler('{{ complex.id }}', '{{ apt.id }}', this)"
							title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
							style="position: absolute; top: 10px; right: 10px; z-index: 10; background: white; border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.15); color: #ccc; transition: all 0.2s;">
							<i class="far fa-heart"></i>
						</button>
						{% if apt.layout_photos %}
						{% for photo in apt.layout_photos %}
						<img src="{{ photo }}"
							alt="{% if apt.title %}{{ apt.title }}{% elif apt.rooms %}{{ apt.rooms }}-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞{% if apt.area %}, {{ apt.area }} –º¬≤{% endif %}{% elif apt.area %}–ö–≤–∞—Ä—Ç–∏—Ä–∞, {{ apt.area }} –º¬≤{% else %}–ö–≤–∞—Ä—Ç–∏—Ä–∞{% endif %}"
							class="gallery-image"
							style="display: {% if forloop.first %}block{% else %}none{% endif %};">
						{% endfor %}

						{% if apt.layout_photos|length > 1 %}
						<button class="gallery-nav gallery-prev"
							onclick="event.stopPropagation(); changeImage(this, -1)">
							<i class="fas fa-chevron-left"></i>
						</button>
						<button class="gallery-nav gallery-next"
							onclick="event.stopPropagation(); changeImage(this, 1)">
							<i class="fas fa-chevron-right"></i>
						</button>
						<div class="gallery-dots">
							{% for photo in apt.layout_photos %}
							<span class="dot {% if forloop.first %}active{% endif %}"
								onclick="event.stopPropagation(); setImage(this, {{ forloop.counter0 }})"></span>
							{% endfor %}
						</div>
						{% endif %}
						{% else %}
						<div
							style="width: 100%; height: 200px; display: flex; align-items: center; justify-content: center; color: #9ca3af; background: #f3f4f6; flex-direction: column;">
							<i class="fas fa-image" style="font-size: 48px;"></i>
							<div style="margin-top: 12px; font-size: 12px; text-align: center;">
								–ù–µ—Ç —Ñ–æ—Ç–æ<br>
								Debug: layout_photos = {{ apt.layout_photos|default:"None" }}
							</div>
						</div>
						{% endif %}
					</div>

					<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–≤–∞—Ä—Ç–∏—Ä–µ -->
					<div class="compact-card-content" style="padding: 16px;">
						<div class="compact-card-header">
							<h3 class="compact-card-title"
								style="font-size: 16px; font-weight: 600; color: #1f2937; margin-bottom: 8px;">
								{% if apt.title %}
									{{ apt.title }}
								{% elif apt.rooms %}
									{{ apt.rooms }}-–∫–æ–º–Ω–∞—Ç–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞{% if apt.area %}, {{ apt.area }} –º¬≤{% endif %}
								{% elif apt.area %}
									–ö–≤–∞—Ä—Ç–∏—Ä–∞, {{ apt.area }} –º¬≤
								{% else %}
									–ö–≤–∞—Ä—Ç–∏—Ä–∞
								{% endif %}
							</h3>
						</div>
						<div class="compact-card-price">
							<div class="compact-price-text"
								style="font-size: 24px; font-weight: 700; color: #2563eb; margin-bottom: 4px;">
								{{ apt.formatted_price|default:apt.price }}
							</div>
						</div>
						{% if apt.formatted_price_per_sqm and apt.formatted_price_per_sqm != '' %}
						<div class="apt-price-per-m" style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">{{ apt.formatted_price_per_sqm }}</div>
						{% elif apt.price_per_square %}
						<div class="apt-price-per-m" style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">{{ apt.price_per_square }}</div>
						{% elif apt.pricePerSqm %}
						<div class="apt-price-per-m" style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">{{ apt.pricePerSqm|floatformat:0 }} ‚ÇΩ/–º¬≤</div>
						{% endif %}
						<div class="compact-card-details" style="display: flex; flex-direction: column; gap: 4px;">
							{% if apt.completion_date %}
							<div class="compact-detail-item"
								style="display: flex; align-items: center; gap: 6px; font-size: 13px; color: #6b7280;">
								<i class="fas fa-calendar"></i>
								<span>{{ apt.completion_date }}</span>
							</div>
							{% endif %}
						</div>

						<!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–≤–∞—Ä—Ç–∏—Ä—ã -->
						<div style="margin-top: 12px;">
							<a href="{% url 'main:apartment_detail' complex.id apt.id %}" class="apartment-detail-link" target="_blank" rel="noopener noreferrer"
								style="display: flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 16px; background: linear-gradient(135deg, #beaf87 0%, #d4af37 100%); color: #1f2937; text-decoration: none; border-radius: 8px; font-size: 14px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(190,175,135,0.3);">
								<i class="fas fa-eye"></i>
								–ü–æ–¥—Ä–æ–±–Ω–µ–µ
							</a>
						</div>
					</div>
				</div>
				{% endfor %}
				{% else %}
				<div class="no-apartments-cta">
					<div class="no-apartments-icon">
						<span>üéß</span>
					</div>
					<h3>–ü–æ–¥–±–µ—Ä—ë–º –∫–≤–∞—Ä—Ç–∏—Ä—É –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞</h3>
					<p>–í —ç—Ç–æ–º –ñ–ö –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∞–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.</p>
					<button type="button" class="no-apartments-btn anchor-feedback-btn">
						–ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
					</button>
				</div>
				{% endif %}
				{% endwith %}
			</div>

			<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ -->
			<div class="apt-pagination" data-type-pagination="{{ apt_type }}"
				style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 24px;">
				<!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
			</div>
		</div>
		{% endfor %}
	{% else %}
		<div class="no-apartments-cta">
			<div class="no-apartments-icon">
				<span>üéß</span>
			</div>
			<h3>–ü–æ–¥–±–µ—Ä—ë–º –∫–≤–∞—Ä—Ç–∏—Ä—É –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞</h3>
			<p>–í —ç—Ç–æ–º –ñ–ö –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–±–µ—Ä—ë—Ç –ø–æ—Ö–æ–∂–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.</p>
			<button type="button" class="no-apartments-btn anchor-feedback-btn">
				–ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
			</button>
		</div>
	{% endif %}
	</div>
	{% endif %}

	{% if not is_secondary and not is_mongodb %}
	<!-- –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è SQL -->
	<div class="detail-prices">
		<h2>–¶–µ–Ω—ã –ø–æ —Ç–∏–ø–∞–º –∫–≤–∞—Ä—Ç–∏—Ä</h2>
		<div class="prices-grid">
			<div class="price-item">
				<span class="room-type">–°—Ç—É–¥–∏—è</span>
				<span class="room-price">–æ—Ç {{ complex.studio_price|default:complex.price_from|floatformat:1 }} –º–ª–Ω
					‚ÇΩ</span>
			</div>
			<div class="price-item">
				<span class="room-type">1-–∫–æ–º–Ω.</span>
				<span class="room-price">–æ—Ç {{ complex.one_room_price|default:complex.price_from|floatformat:1 }} –º–ª–Ω
					‚ÇΩ</span>
			</div>
			<div class="price-item">
				<span class="room-type">2-–∫–æ–º–Ω.</span>
				<span class="room-price">–æ—Ç {{ complex.two_room_price|default:complex.price_from|floatformat:1 }} –º–ª–Ω
					‚ÇΩ</span>
			</div>
			<div class="price-item">
				<span class="room-type">3-–∫–æ–º–Ω.</span>
				<span class="room-price">–æ—Ç {{ complex.three_room_price|default:complex.price_from|floatformat:1 }} –º–ª–Ω
					‚ÇΩ</span>
			</div>
			<div class="price-item">
				<span class="room-type">4-–∫–æ–º–Ω.+</span>
				<span class="room-price">–æ—Ç {{ complex.four_room_price|default:complex.price_from|floatformat:1 }} –º–ª–Ω
					‚ÇΩ</span>
			</div>
		</div>
	</div>
	{% endif %}

	<!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
	<div class="detail-gallery" style="margin: 32px 0;">
		<h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">{% if is_secondary %}–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏{% else
			%}–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ñ–ö{% endif %}</h2>
		<div class="gallery-grid"
			style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
			{% if is_secondary and complex.photos %}
			{% for photo in complex.photos %}
			<div class="gallery-item" data-image="{{ photo }}" onclick="openGalleryModal({{ forloop.counter0 }})"
				style="position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; aspect-ratio: 4/3; transition: transform 0.3s;">
				<img src="{{ photo }}" alt="{{ complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;"
					onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
				<div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); padding: 12px; color: white; font-size: 14px; opacity: 0; transition: opacity 0.3s;"
					onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
					<i class="fas fa-search-plus"></i> –£–≤–µ–ª–∏—á–∏—Ç—å
				</div>
			</div>
			{% endfor %}
			{% elif is_mongodb and complex.photos %}
			{% for photo in complex.photos %}
			<div class="gallery-item" data-image="{{ photo }}" onclick="openGalleryModal({{ forloop.counter0 }})"
				style="position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; aspect-ratio: 4/3; transition: transform 0.3s;">
				<img src="{{ photo }}" alt="{{ complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;"
					onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
				<div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); padding: 12px; color: white; font-size: 14px; opacity: 0; transition: opacity 0.3s;"
					onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
					<i class="fas fa-search-plus"></i> –£–≤–µ–ª–∏—á–∏—Ç—å
				</div>
			</div>
			{% empty %}
			<div class="gallery-item main" data-image="{{ PLACEHOLDER_IMAGE_URL }}"
				style="position: relative; border-radius: 12px; overflow: hidden; aspect-ratio: 4/3;">
				<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover;">
			</div>
			{% endfor %}
			{% elif is_mongodb and complex.photos %}
			{% for photo in complex.photos %}
			<div class="gallery-item" data-image="{{ photo }}" onclick="openGalleryModal({{ forloop.counter0 }})"
				style="position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; aspect-ratio: 4/3; transition: transform 0.3s;">
				<img src="{{ photo }}" alt="{{ complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;"
					onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
				<div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); padding: 12px; color: white; font-size: 14px; opacity: 0; transition: opacity 0.3s;"
					onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
					<i class="fas fa-search-plus"></i> –£–≤–µ–ª–∏—á–∏—Ç—å
				</div>
			</div>
			{% endfor %}
			{% else %}
			{% for image in complex.get_images %}
			{% if image.image %}
			<div class="gallery-item {% if image.is_main %}main{% endif %}" data-image="{{ image.image.url }}"
				onclick="openGalleryModal({{ forloop.counter0 }})"
				style="position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; aspect-ratio: 4/3;">
				<img src="{{ image.image.url }}" alt="{{ image.title|default:complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover;">
			</div>
			{% endif %}
			{% empty %}
			<div class="gallery-item main" data-image="{{ PLACEHOLDER_IMAGE_URL }}"
				style="position: relative; border-radius: 12px; overflow: hidden; aspect-ratio: 4/3;">
				<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ complex.name }}"
					style="width: 100%; height: 100%; object-fit: cover;">
			</div>
			{% endfor %}
			{% endif %}
		</div>
	</div>

	<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ -->
	<div id="galleryModal"
		style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:10000; align-items:center; justify-content:center;"
		onclick="closeGalleryModal()">
		<button onclick="closeGalleryModal()"
			style="position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.2); border:none; width:50px; height:50px; border-radius:999px; cursor:pointer; color:white; font-size:24px; z-index:10001;">√ó</button>
		<button onclick="event.stopPropagation(); changeGalleryPhoto(-1)"
			style="position:absolute; left:20px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.2); border:none; width:50px; height:50px; border-radius:999px; cursor:pointer; color:white; font-size:24px; z-index:10001;">‚Äπ</button>
		<button onclick="event.stopPropagation(); changeGalleryPhoto(1)"
			style="position:absolute; right:20px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.2); border:none; width:50px; height:50px; border-radius:999px; cursor:pointer; color:white; font-size:24px; z-index:10001;">‚Ä∫</button>
		<div style="max-width: 90%; max-height: 90%; display: flex; align-items: center; justify-content: center;"
			onclick="event.stopPropagation()">
			<img id="galleryModalImage" src="" alt=""
				style="max-width: 100%; max-height: 90vh; object-fit: contain; border-radius: 8px;">
		</div>
		<div
			style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); color:white; padding:10px 20px; border-radius:20px; font-size:16px; z-index:10001;">
			<span id="galleryModalCounter">1</span> / <span id="galleryModalTotal">1</span>
		</div>
	</div>

	<!-- –ö–æ—Ä–ø—É—Å–∞ –∏ —Å—Ä–æ–∫–∏ —Å–¥–∞—á–∏ -->
	{% if is_mongodb and complex.korpuses %}
	{% comment %}–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ—Ä–ø—É—Å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏{% endcomment %}
	{% for korpus in complex.korpuses %}
	{% if korpus.name and korpus.quarter and korpus.year %}
	{% if forloop.first %}
	<div class="korpuses-section" style="margin: 32px 0;">
		<h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">–ö–æ—Ä–ø—É—Å–∞ –∏ —Å—Ä–æ–∫–∏ —Å–¥–∞—á–∏</h2>
		<div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
			<div class="korpuses-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
				{% endif %}
				<div class="korpus-item"
					style="display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-bottom: 1px solid #e5e7eb; {% if forloop.counter0|divisibleby:2 %}border-left: 1px solid #e5e7eb;{% endif %}">
					<span class="korpus-name" style="font-size: 15px; color: #374151; font-weight: 500; flex: 1; min-width: 0; margin-right: 12px;">
						<i class="fas fa-building" style="color: #667eea; margin-right: 8px;"></i>{{ korpus.name }}
					</span>
					<span class="korpus-date" style="font-size: 15px; color: #6b7280; white-space: nowrap; flex-shrink: 0;">{{ korpus.quarter }} –∫–≤. {{ korpus.year }}</span>
				</div>
				{% if forloop.last %}
			</div>
		</div>
	</div>
	{% endif %}
	{% endif %}
	{% endfor %}
	{% endif %}

	<!-- –•–æ–¥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ -->
	{% if is_mongodb and complex.construction_progress and complex.construction_progress.construction_stages %}
	<div class="construction-progress-section" style="margin: 32px 0;">
		<h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">–•–æ–¥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h2>
		<div class="construction-stages-container">
			<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —ç—Ç–∞–ø–æ–≤ -->
			<div id="constructionStagesGrid" class="construction-stages-grid"
				style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 24px;">
				<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
			</div>

			<!-- –ù–∏–∂–Ω—è—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è -->
			<div class="construction-pagination-bottom advanced-pagination">
				<button id="prevStagesBtnBottom" class="pagination-btn" disabled>
					<i class="fas fa-chevron-left"></i>
				</button>
				<div class="pagination-pages" id="bottomPaginationPages"></div>
				<button id="nextStagesBtnBottom" class="pagination-btn">
					<i class="fas fa-chevron-right"></i>
				</button>
			</div>
		</div>
	</div>
	{% endif %}

	<!-- –ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –ñ–ö -->
	{% if complex.latitude and complex.longitude %}
	<div class="detail-map-section" style="margin: 32px 0;">
		<h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ñ–ö</h2>
		<div class="map-container">
			<div id="detail-map" style="width: 100%; height: 400px; border-radius: 12px; overflow: hidden;"></div>
		</div>
	</div>
	{% endif %}

	{% if videos %}
	<!-- –í–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã –ñ–ö –ø–ª–∏—Ç–∫–æ–π -->
	<div class="detail-video" style="margin: 24px 0;">
		<h2>–í–∏–¥–µ–æ–æ–±–∑–æ—Ä—ã –ñ–ö</h2>
		<div class="videos-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
			{% for v in videos|slice:':3' %}
			<a href="{% url 'main:video_detail' v.id %}" class="video-card"
				style="background:#000; border-radius:12px; overflow:hidden; position:relative; aspect-ratio:16/9; text-decoration:none; display:block;">
				{% if v.thumbnail_url %}
				<img src="{{ v.thumbnail_url }}" alt="{{ v.title }}" style="width:100%; height:100%; object-fit:cover;">
				<div
					style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); display:flex; align-items:center; justify-content:center;">
					<i class="fas fa-play" style="font-size: 48px; color: white;"></i>
				</div>
				{% else %}
				<div
					style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background: #f5f5f5; color: #666;">
					<i class="fas fa-play" style="font-size: 48px;"></i>
				</div>
				{% endif %}
			</a>
			{% endfor %}
		</div>
		<div style="text-align:center;margin-top:24px;">
			<a class="btn btn-catalog" href="{% url 'main:video_detail' videos.0.id %}">
				<i class="fas fa-play-circle"></i>
				–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ–æ–±–∑–æ—Ä–∞–º –ñ–ö
			</a>
		</div>
	</div>
	{% endif %}

	{% if complex_offers %}
	<!-- –ê–∫—Ü–∏–∏ –ñ–ö -->
	<div class="complex-offers-section" style="margin: 32px 0;">
		<div class="offers-header" style="text-align:center;margin-bottom:24px;">
			<h2 class="section-title" style="font-size:28px;font-weight:700;color:#222;margin:0;">–ê–∫—Ü–∏–∏ {{ complex.name }}</h2>
		</div>
		<div class="offers-grid">
			{% for offer in complex_offers %}
			<a href="{% url 'main:offer_detail' offer.id %}" class="offer-card">
				<div class="offer-media">
					{% if offer.get_main_image and offer.get_main_image.image %}
					<img src="{{ offer.get_main_image.image.url }}" alt="{{ offer.title }}" loading="lazy"
						decoding="async">
					{% else %}
					<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ offer.title }}" loading="lazy" decoding="async">
					{% endif %}
				</div>
				<div class="offer-content">
					<div class="offer-head">
						<span class="offer-chip">{{ offer.residential_complex.name }}</span>
						<h3 class="offer-title"
							style="margin:0;font-size:16px;font-weight:800;color:#222;line-height:1.3;word-wrap:break-word;hyphens:auto;">
							{{ offer.title }}</h3>
					</div>
					<div class="offer-limited">
						<i class="far fa-clock" style="color:var(--c21-gold);font-size:12px;"></i>
						<span>
							{% if offer.expires_at %}
							–î–æ {{ offer.expires_at|date:"d.m.Y" }}
							{% else %}
							–í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
							{% endif %}
						</span>
					</div>
					<div class="offer-actions">
						<span class="btn btn-primary btn-small offer-cta">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∞–∫—Ü–∏–∏</span>
					</div>
				</div>
			</a>
			{% endfor %}
		</div>
	</div>
	{% endif %}

	<!-- –î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∞–≥–µ–Ω—Ç–∞ -->
	{% if agent and agent_other_properties %}
	<div class="agent-properties-section">
		<h2>–î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∞–≥–µ–Ω—Ç–∞ {{ agent.full_name }}</h2>
		<div class="similar-grid">
			{% for property in agent_other_properties %}
			<div class="similar-card">
				<div class="similar-image">
					{% if property.image and property.image.image %}
					<img src="{{ property.image.image.url }}" alt="{{ property.name }}">
					{% else %}
					<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ property.name }}">
					{% endif %}
					<!-- –ë–µ–π–¥–∂ —Ç–∏–ø–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
					<div class="property-type-badge">
						{% if property.type == 'residential' %}
						<span class="badge badge-primary">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞</span>
						{% else %}
						<span class="badge badge-secondary">–í—Ç–æ—Ä–∏—á–Ω–∞—è</span>
						{% endif %}
					</div>
				</div>
				<div class="similar-content">
					<h3 class="similar-title">{{ property.name }}</h3>
					<div class="similar-location">{{ property.location }}</div>
					<div class="similar-price">
						{% if property.type == 'residential' %}
						–æ—Ç {{ property.price|floatformat:1 }} –º–ª–Ω ‚ÇΩ
						{% else %}
						{{ property.price|floatformat:1 }} –º–ª–Ω ‚ÇΩ
						{% endif %}
					</div>
					<a href="{{ property.url }}?agent_id={{ agent.id }}" class="btn btn-outline btn-small"
						target="_blank" rel="noopener noreferrer"
						style="margin-top: 8px; width: 100%; justify-content: center;">
						–ü–æ–¥—Ä–æ–±–Ω–µ–µ
					</a>
				</div>
			</div>
			{% endfor %}
		</div>

		<!-- –ö–Ω–æ–ø–∫–∞ "–í—Å–µ –æ–±—ä–µ–∫—Ç—ã –∞–≥–µ–Ω—Ç–∞" -->
		<div style="text-align: center; margin-top: 24px;">
			<a href="{% url 'main:agent_properties' agent.id %}" class="btn btn-secondary" target="_blank"
				rel="noopener noreferrer">
				<i class="fas fa-building"></i>
				–í—Å–µ –æ–±—ä–µ–∫—Ç—ã –∞–≥–µ–Ω—Ç–∞
			</a>
		</div>
	</div>
	{% endif %}

	<!-- –ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω) -->
	<div class="mortgage-calculator" id="mortgage">
		<div class="calculator-container">
			<!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
			<div class="calculator-settings">
				<div class="calculator-header">
					<h2 class="calculator-title">
						<i class="fas fa-calculator"></i>
						–ò–ø–æ—Ç–µ–∫–∞ –æ–Ω–ª–∞–π–Ω
						<span class="calculator-note">*</span>
					</h2>
					<p class="calculator-subtitle">–û–¥–Ω–∞ –∑–∞—è–≤–∫–∞ –≤–æ –≤—Å–µ –±–∞–Ω–∫–∏</p>
				</div>

				<!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∞–≤–∫–æ–π -->
				<input id="mp-rate-fixed" type="hidden"
					value="{% if mortgage_programs %}{{ mortgage_programs.first.rate }}{% else %}11.4{% endif %}" />

				<div class="settings-form">
					<!-- –¢–∏–ø –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
					<div class="form-group">
						<label class="form-label">–¢–∏–ø –ø—Ä–æ–≥—Ä–∞–º–º—ã</label>
						<div class="select-wrapper">
							<select id="mp-program" class="form-select">
								{% for p in mortgage_programs %}
								<option value="{{ p.rate }}">{{ p.name }}{% if p.is_individual %} (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è) {% endif %}</option>
								{% endfor %}
							</select>
							<i class="fas fa-chevron-down select-icon"></i>
						</div>
					</div>

					<!-- –°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
					<div class="form-group">
						<label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
						<div class="input-wrapper">
							<input id="mp-price-input" class="form-input" type="text" inputmode="numeric"
								value="5 000 000" />
							<span class="input-currency">‚ÇΩ</span>
						</div>
						<input id="mp-price" class="form-range" type="range" min="800000" max="87500000" step="50000"
							value="5000000" />
					</div>

					<!-- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å -->
					<div class="form-group">
						<label class="form-label">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å</label>
						<div class="input-wrapper">
							<input id="mp-down-amt-input" class="form-input" type="text" inputmode="numeric"
								value="1 000 000" />
							<span class="input-currency">‚ÇΩ</span>
						</div>
						<div class="range-wrapper">
							<input id="mp-down" class="form-range" type="range" min="10" max="80" step="1" value="20" />
							<span id="mp-down-pct-view" class="range-percentage">20%</span>
						</div>
					</div>

					<!-- –°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ -->
					<div class="form-group">
						<label class="form-label">–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞</label>
						<div class="input-wrapper">
							<input id="mp-years-input" class="form-input form-input-small" type="number" min="3"
								max="30" step="1" value="30" />
							<span class="input-unit">–ª–µ—Ç</span>
						</div>
						<input id="mp-years" class="form-range" type="range" min="3" max="30" step="1" value="30" />
					</div>
				</div>
			</div>

			<!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
			<div class="calculator-results">
				<div class="results-header">
					<h3 class="results-title">–†–∞—Å—á—ë—Ç –∏–ø–æ—Ç–µ–∫–∏</h3>
				</div>

				<div class="results-content">
					<div class="result-item main-result">
						<div class="result-label">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂</div>
						<div id="mp-month" class="result-value">60 283 ‚ÇΩ</div>
					</div>

					<div class="result-item">
						<div class="result-label">–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞</div>
						<div id="mp-rate-text" class="result-value">–æ—Ç 18.0 %</div>
					</div>

					<div class="result-item">
						<div class="result-label">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞</div>
						<div id="mp-loan" class="result-value">4 000 000 ‚ÇΩ</div>
					</div>
				</div>

				<div class="bank-logos">
					<img src="/media/logo/banks.png" alt="–ë–∞–Ω–∫–∏-–ø–∞—Ä—Ç–Ω—ë—Ä—ã" class="bank-logos-img" />
				</div>

				<div class="results-actions">
					<a href="#feedback-title" class="btn btn-catalog anchor-feedback-btn">
						<i class="fas fa-paper-plane"></i>
						–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É
					</a>
				</div>

				<div class="calculator-disclaimer">
					* –†–∞—Å—á—ë—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π. –£—Ç–æ—á–Ω—è–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —É –Ω–∞—à–µ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞, –æ—Å—Ç–∞–≤–∏–≤ –∑–∞—è–≤–∫—É
				</div>
			</div>
		</div>
	</div>

	<!-- –ë–ª–æ–∫ —Å —Ü–µ–Ω–∞–º–∏ –±—ã–ª –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤—ã—à–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –∑–¥–µ—Å—å —É–¥–∞–ª—ë–Ω -->

	<!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É –ø–µ—Ä–µ–¥ –ø–æ—Ö–æ–∂–∏–º–∏ –ñ–ö -->
	<div style="margin: 24px 0; text-align: center;">
		<a href="{% if is_secondary %}{% url 'main:secondary_index' %}{% else %}{% url 'main:catalog' %}{% endif %}"
			class="btn btn-catalog">
			<i class="fas fa-th-large"></i>
			–ù–∞–∑–∞–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥ –ñ–ö
		</a>
	</div>

	<!-- –ü–æ—Ö–æ–∂–∏–µ –ñ–ö -->
	{% if similar_complexes %}
	<div class="similar-complexes">
		<h2>{% if agent %}–î—Ä—É–≥–∏–µ –ø–æ—Ö–æ–∂–∏–µ –ñ–ö{% else %}–ü–æ—Ö–æ–∂–∏–µ –ñ–ö{% endif %}</h2>
		<div class="similar-grid">
			{% for similar in similar_complexes %}
			{% if is_secondary %}
			<div class="similar-card" data-url="/secondary/{{ similar.id }}/" style="cursor: pointer;">
			{% else %}
			<div class="similar-card" data-url="/complex/{{ similar.id }}/" style="cursor: pointer;">
			{% endif %}
				<div class="similar-image">
					{% if similar.get_main_image and similar.get_main_image.image %}
					<img src="{{ similar.get_main_image.image.url }}" alt="{{ similar.name }}">
					{% else %}
					<img src="{{ PLACEHOLDER_IMAGE_URL }}" alt="{{ similar.name }}">
					{% endif %}
				</div>
				<div class="similar-content">
					<h3 class="similar-title">{{ similar.name }}</h3>
					<div class="similar-location">{{ similar.district|default:similar.city }}</div>
					<div class="similar-price">–æ—Ç {{ similar.price_from|floatformat:1 }} –º–ª–Ω ‚ÇΩ</div>
				</div>
			</div>
			{% endfor %}
		</div>
	</div>
	{% endif %}
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		// –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–∞–ª–µ—Ä–µ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
		const galleryItems = document.querySelectorAll('.gallery-item');
		const heroImage = document.querySelector('.hero-main-image');
		const prevBtn = document.querySelector('.photo-nav-btn.prev');
		const nextBtn = document.querySelector('.photo-nav-btn.next');
		let currentIndex = 0;
		const allItems = Array.from(galleryItems);
		function setActiveByIndex(idx) {
			if (!allItems.length) return;
			currentIndex = (idx + allItems.length) % allItems.length;
			const newActive = allItems[currentIndex];
			allItems.forEach(i => i.classList.remove('active'));
			newActive.classList.add('active');
			const imageUrl = newActive.getAttribute('data-image') || newActive.querySelector('img')?.src;
			if (imageUrl && heroImage) heroImage.src = imageUrl;
		}
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ
		if (allItems.length) {
			const initial = document.querySelector('.gallery-item.main') || allItems[0];
			currentIndex = allItems.indexOf(initial);
			setActiveByIndex(currentIndex);
		}

		galleryItems.forEach(item => {
			item.addEventListener('click', function () {
				const idx = allItems.indexOf(this);
				setActiveByIndex(idx);
			});
		});

		// –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
		let slideshowTimer = null;
		function startSlideshow() {
			stopSlideshow();
			slideshowTimer = setInterval(() => setActiveByIndex(currentIndex + 1), 5000);
		}
		function stopSlideshow() { if (slideshowTimer) { clearInterval(slideshowTimer); slideshowTimer = null; } }
		startSlideshow();

		// –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
		prevBtn?.addEventListener('click', function () { stopSlideshow(); setActiveByIndex(currentIndex - 1); startSlideshow(); });
		nextBtn?.addEventListener('click', function () { stopSlideshow(); setActiveByIndex(currentIndex + 1); startSlideshow(); });

		// –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
		const actionItems = document.querySelectorAll('.action-item');
		actionItems.forEach(item => {
			item.addEventListener('click', function () {
				const actionText = this.querySelector('span').textContent;
			});
		});



		const mortgageBtn = document.querySelector('.mortgage-btn');
		if (mortgageBtn) {
			mortgageBtn.addEventListener('click', function () {
				// smooth scroll handled via anchor; no alerts
			});
		}

		// –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ
		const photoNavBtns = document.querySelectorAll('.photo-nav-btn');
		photoNavBtns.forEach(btn => {
			btn.addEventListener('click', function () {
				const isNext = this.classList.contains('next');
				const currentActive = document.querySelector('.gallery-item.active') || document.querySelector('.gallery-item');
				const allItems = document.querySelectorAll('.gallery-item');
				const currentIndex = Array.from(allItems).indexOf(currentActive);

				let newIndex;
				if (isNext) {
					newIndex = (currentIndex + 1) % allItems.length;
				} else {
					newIndex = currentIndex === 0 ? allItems.length - 1 : currentIndex - 1;
				}

				const newActive = allItems[newIndex];
				if (newActive) {
					allItems.forEach(item => item.classList.remove('active'));
					newActive.classList.add('active');

					const imageUrl = newActive.getAttribute('data-image');
					if (imageUrl && heroImage) {
						heroImage.src = imageUrl;
					}
				}
			});
		});

		// –ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–æ–±–Ω–æ–≤–ª—ë–Ω –ø–æ–¥ –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω)
		(function () {
			const baseRateEl = document.getElementById('mp-rate-fixed');
			const program = document.getElementById('mp-program');
			const price = document.getElementById('mp-price');
			const down = document.getElementById('mp-down');
			const years = document.getElementById('mp-years');
			const monthEl = document.getElementById('mp-month');
			const loanEl = document.getElementById('mp-loan');
			const rateText = document.getElementById('mp-rate-text');
			const downPctView = document.getElementById('mp-down-pct-view');
			const priceInput = document.getElementById('mp-price-input');
			const downAmtInput = document.getElementById('mp-down-amt-input');
			const yearsInput = document.getElementById('mp-years-input');
			function fmt(n) { return new Intl.NumberFormat('ru-RU').format(Math.round(n)); }
			function parseNum(v) { return Number(String(v || '').replace(/[^\d]/g, '')) || 0; }
			function formatInputKeepCaret(inputEl) {
				const start = inputEl.selectionStart || 0;
				const leftDigits = (inputEl.value.slice(0, start).match(/\d/g) || []).length;
				const digits = inputEl.value.replace(/[^\d]/g, '');
				const formatted = digits.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
				inputEl.value = formatted;
				let pos = 0, seen = 0;
				while (pos < formatted.length && seen < leftDigits) {
					if (/\d/.test(formatted.charAt(pos))) seen++;
					pos++;
				}
				inputEl.setSelectionRange(pos, pos);
			}
			function calc() {
				const p = priceInput ? (parseNum(priceInput.value) || Number(price.value)) : Number(price.value);
				const downPct = Number(down.value) / 100;
				const rateVal = program ? Number(program.value || baseRateEl?.value || 11.4) : Number(baseRateEl?.value || 11.4);
				const rate = rateVal / 100; // –≥–æ–¥–æ–≤–∞—è
				const n = Number(years.value) * 12;
				const monthlyRate = rate / 12;
				const firstPay = p * downPct;
				const loan = Math.max(0, p - firstPay);
				const annuity = monthlyRate ? loan * (monthlyRate * Math.pow(1 + monthlyRate, n)) / (Math.pow(1 + monthlyRate, n) - 1) : (n ? loan / n : 0);
				monthEl.textContent = fmt(annuity) + ' ‚ÇΩ';
				loanEl.textContent = fmt(loan) + ' ‚ÇΩ';
				if (rateText) rateText.textContent = '–æ—Ç ' + (rateVal.toFixed(1)) + ' %';
				if (downPctView) downPctView.textContent = Math.round(downPct * 100) + '%';
				if (yearsInput) yearsInput.value = Number(years.value);
			}
			['change', 'input'].forEach(ev => {
				program && program.addEventListener(ev, calc);
				years.addEventListener(ev, calc);
			});
			// Sync from range: price -> text + amount
			price.addEventListener('input', function () {
				const val = Number(price.value);
				if (priceInput) { priceInput.value = fmt(val); }
				if (downAmtInput) { downAmtInput.value = fmt(val * (Number(down.value) / 100)); downAmtInput.max = String(val); }
				calc();
			});
			// Sync from down slider -> amount
			down.addEventListener('input', function () {
				const p = priceInput ? (parseNum(priceInput.value) || Number(price.value)) : Number(price.value);
				if (downAmtInput) { downAmtInput.value = fmt(p * (Number(down.value) / 100)); }
				calc();
			});
			// –†—É—á–Ω–æ–π –≤–≤–æ–¥ —Ü–µ–Ω—ã —Å –∂–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
			if (priceInput) {
				priceInput.addEventListener('input', function () {
					formatInputKeepCaret(this);
					const raw = parseNum(this.value);
					if (downAmtInput) { downAmtInput.max = String(raw); }
					calc();
				});
				priceInput.addEventListener('blur', function () {
					const min = Number(price.min), max = Number(price.max);
					let val = parseNum(this.value);
					val = Math.max(min, Math.min(max, val));
					this.value = fmt(val);
					price.value = String(val);
					if (downAmtInput) { downAmtInput.max = String(val); downAmtInput.value = fmt(val * (Number(down.value) / 100)); }
					calc();
				});
			}
			// –†—É—á–Ω–æ–π –≤–≤–æ–¥ —Å—É–º–º—ã –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞ —Å –∂–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
			if (downAmtInput) {
				downAmtInput.addEventListener('input', function () {
					formatInputKeepCaret(this);
					const p = priceInput ? (parseNum(priceInput.value) || Number(price.value)) : Number(price.value);
					let amt = parseNum(this.value);
					amt = Math.max(0, Math.min(p, amt));
					const pctRaw = p ? (amt / p) * 100 : 0;
					const pct = Math.min(80, Math.max(10, Math.round(pctRaw)));
					down.value = String(pct);
					calc();
				});
				downAmtInput.addEventListener('blur', function () {
					const p = priceInput ? (parseNum(priceInput.value) || Number(price.value)) : Number(price.value);
					let amt = parseNum(this.value);
					amt = Math.max(0, Math.min(p, amt));
					this.value = fmt(amt);
				});
			}
			if (yearsInput) {
				yearsInput.addEventListener('input', function () {
					const min = Number(years.min), max = Number(years.max);
					let val = Number(this.value || 0);
					val = Math.max(min, Math.min(max, val));
					years.value = String(val);
					calc();
				});
			}
			// –Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
			if (priceInput) { priceInput.value = fmt(Number(price.value)); }
			if (downAmtInput) { const p0 = Number(price.value); downAmtInput.value = fmt(p0 * (Number(down.value) / 100)); downAmtInput.max = String(p0); }
			calc();
		})();

		// –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Ö–æ–∂–∏—Ö –ñ–ö
		const similarCards = document.querySelectorAll('.similar-card');
		similarCards.forEach(card => {
			const url = card.dataset.url;
			if (url) {
				card.addEventListener('click', function () {
					window.open(url, '_blank');
				});
			}
		});


		// –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ –±–ª–æ–∫—É –∏–ø–æ—Ç–µ–∫–∏ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
		document.querySelectorAll('a[href="#mortgage"]').forEach(a => {
			a.addEventListener('click', function (e) {
				e.preventDefault();
				const target = document.getElementById('mortgage');
				if (target) {
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–ø–æ—Ç–µ–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ —Å–∫—Ä—ã—Ç—ã
					target.style.opacity = '1';
					target.style.transform = 'translateY(0)';

					// –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç—Å—Ç—É–ø–æ–º
					const headerOffset = 100;
					const elementPosition = target.getBoundingClientRect().top;
					const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

					window.scrollTo({
						top: offsetPosition,
						behavior: 'smooth'
					});
				}
			});
		});
	});
</script>

<style>
	/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ "–î—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∞–≥–µ–Ω—Ç–∞" */
	.agent-properties-section {
		margin: 40px 0;
		padding: 32px;
		background: #f8f9fa;
		border-radius: 16px;
	}

	.agent-properties-section h2 {
		color: var(--c21-dark);
		margin-bottom: 24px;
		text-align: center;
	}

	.property-type-badge {
		position: absolute;
		top: 12px;
		right: 12px;
		z-index: 2;
	}

	.badge {
		padding: 4px 8px;
		border-radius: 999px;
		font-size: 11px;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.badge-primary {
		background: var(--c21-gold);
		color: var(--c21-dark);
	}

	.badge-secondary {
		background: #6c757d;
		color: white;
	}

	@media (max-width: 768px) {
		.agent-properties-section {
			padding: 24px 16px;
		}
	}

	/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è */
	.detail-map-section {
		margin: 32px 0;
	}

	.detail-map-section h2 {
		margin-bottom: 20px;
		color: var(--c21-dark);
	}

	.map-container {
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
	}

	/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –∫–æ—Ä–ø—É—Å–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
	@media (max-width: 768px) {
		.korpuses-grid {
			grid-template-columns: 1fr !important;
		}

		.korpus-item {
			padding: 12px 16px !important;
			flex-wrap: nowrap !important;
		}

		.korpus-item:not(:last-child) {
			border-left: none !important;
		}

		.korpus-name {
			font-size: 14px !important;
			margin-right: 8px !important;
		}

		.korpus-name .fas {
			font-size: 12px !important;
			margin-right: 6px !important;
		}

		.korpus-date {
			font-size: 12px !important;
			white-space: nowrap !important;
		}
	}

	@media (max-width: 480px) {
		.korpus-item {
			padding: 10px 12px !important;
		}

		.korpus-name {
			font-size: 13px !important;
		}

		.korpus-date {
			font-size: 11px !important;
		}
	}
</style>

<script>
	// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –ñ–ö
	document.addEventListener('DOMContentLoaded', function () {
		{% if complex.latitude and complex.longitude %}
		const mapElement = document.getElementById('detail-map');
		if (mapElement && typeof L !== 'undefined') {
			try {
				// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ñ–ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
				const complexCoords = [{{ complex.latitude }}, {{ complex.longitude }}];

				// –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
				const map = L.map('detail-map', {
					attributionControl: false,
					zoomControl: true,
					scrollWheelZoom: true
				});

				// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –∫–∞—Ä—Ç—ã
				L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					attribution: '&copy; OpenStreetMap'
				}).addTo(map);

				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—Ç—Ä –∏ –∑—É–º
				map.setView(complexCoords, 15);

				// –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –ñ–ö
				const marker = L.marker(complexCoords).addTo(map);
				marker.bindPopup(`
					<div style="text-align: center; padding: 8px;">
						<h4 style="margin: 0; color: #333;">{{ complex.name }}</h4>
					</div>
				`);

				// –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø —Å—Ä–∞–∑—É
				marker.openPopup();
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã –ñ–ö:', error);
			}
		}
	{% endif %}
});
</script>

<script>
	// JavaScript –¥–ª—è MongoDB –≤–µ—Ä—Å–∏–∏
	{% if is_mongodb %}

	// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ñ–æ—Ç–æ –≤ hero —Å–µ–∫—Ü–∏–∏
	let currentHeroPhotoIndex = 0;
	const heroImages = document.querySelectorAll('#heroGallery .hero-main-image');

	function changeHeroPhoto(direction) {
		if (heroImages.length <= 1) return;

		heroImages[currentHeroPhotoIndex].style.display = 'none';
		currentHeroPhotoIndex = (currentHeroPhotoIndex + direction + heroImages.length) % heroImages.length;
		heroImages[currentHeroPhotoIndex].style.display = 'block';

		const counter = document.getElementById('currentPhotoIndex');
		if (counter) counter.textContent = currentHeroPhotoIndex + 1;
	}

	// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–∞–ª–µ—Ä–µ–∏ (—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
	let currentGalleryIndex = 0;
	const galleryPhotos = {{ complex.photos_json| safe }} || [];
	let galleryActivePhotos = galleryPhotos.slice();

	function resolveImageUrl(pathOrUrl) {
		if (!pathOrUrl) return '';
		// –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ –ø–æ–ª–Ω—ã–π URL (S3 –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
		if (pathOrUrl.startsWith('http://') || pathOrUrl.startsWith('https://')) {
			return pathOrUrl;
		}
		// –î–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å) –¥–æ–±–∞–≤–ª—è–µ–º /media/
		try {
			const u = new URL(pathOrUrl, window.location.origin);
			const p = u.pathname;
			return p.startsWith('/media/') ? p : '/media/' + p.replace(/^\//, '');
		} catch (e) {
			return pathOrUrl.startsWith('/media/') ? pathOrUrl : '/media/' + pathOrUrl.replace(/^\//, '');
		}
	}

	function openGalleryWithPhotos(photos, startIndex) {
		galleryActivePhotos = (photos || []).map(resolveImageUrl);
		if (!Number.isFinite(startIndex) || startIndex < 0) startIndex = 0;
		currentGalleryIndex = Math.min(startIndex, Math.max(0, galleryActivePhotos.length - 1));
		const modal = document.getElementById('galleryModal');
		const img = document.getElementById('galleryModalImage');
		const counter = document.getElementById('galleryModalCounter');
		const total = document.getElementById('galleryModalTotal');
		if (modal && img && galleryActivePhotos.length) {
			img.src = galleryActivePhotos[currentGalleryIndex];
			if (counter) counter.textContent = currentGalleryIndex + 1;
			if (total) total.textContent = galleryActivePhotos.length;
			modal.style.display = 'flex';
			document.body.style.overflow = 'hidden';
		}
	}

	function openGalleryModal(index) {
		openGalleryWithPhotos(galleryPhotos, index);
	}

	function openAptGalleryFromCard(containerEl) {
		if (!containerEl) return;
		const imgs = containerEl.querySelectorAll('img.gallery-image');
		const photos = Array.from(imgs).map(img => img.getAttribute('src'));
		openGalleryWithPhotos(photos, 0);
	}

	function closeGalleryModal() {
		const modal = document.getElementById('galleryModal');
		if (modal) {
			modal.style.display = 'none';
			document.body.style.overflow = '';
		}
	}

	function changeGalleryPhoto(direction) {
		if (!galleryActivePhotos.length) return;
		currentGalleryIndex = (currentGalleryIndex + direction + galleryActivePhotos.length) % galleryActivePhotos.length;
		const img = document.getElementById('galleryModalImage');
		const counter = document.getElementById('galleryModalCounter');
		if (img && counter) {
			img.src = galleryActivePhotos[currentGalleryIndex];
			counter.textContent = currentGalleryIndex + 1;
		}
	}

	// –ö–ª–∞–≤–∏—à–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –≥–∞–ª–µ—Ä–µ–µ
	document.addEventListener('keydown', function (e) {
		const modal = document.getElementById('galleryModal');
		if (modal && modal.style.display === 'flex') {
			if (e.key === 'ArrowLeft') changeGalleryPhoto(-1);
			if (e.key === 'ArrowRight') changeGalleryPhoto(1);
			if (e.key === 'Escape') closeGalleryModal();
		}

	});

	// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–≤–∞—Ä—Ç–∏—Ä
	function filterApartmentsByType(type) {
		// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
		const sections = document.querySelectorAll('.apartments-type-section');
		sections.forEach(section => {
			section.style.display = 'none';
		});

		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
		const activeSection = document.querySelector(`[data-type-section="${type}"]`);
		if (activeSection) {
			activeSection.style.display = 'block';
			initializePagination(type);
		}

		// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
		const buttons = document.querySelectorAll('.apt-filter-btn');
		buttons.forEach(btn => {
			if (btn.dataset.type === type) {
				btn.style.background = '#2563eb';
				btn.style.color = 'white';
				btn.style.borderColor = '#2563eb';
				btn.classList.add('active');
			} else {
				btn.style.background = 'white';
				btn.style.color = '#374151';
				btn.style.borderColor = '#e5e7eb';
				btn.classList.remove('active');
			}
		});
	}

	// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è —Ç–∏–ø–∞ –∫–≤–∞—Ä—Ç–∏—Ä
	function initializePagination(type) {
		const section = document.querySelector(`[data-type-section="${type}"]`);
		if (!section) return;

		const cards = section.querySelectorAll('.apartment-card');
		const totalCards = cards.length;
		const perPage = 6;
		const totalPages = Math.ceil(totalCards / perPage);

		if (totalPages <= 1) {
			// –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–¥–Ω–∞, —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
			const pagination = section.querySelector('.apt-pagination');
			if (pagination) pagination.style.display = 'none';
			return;
		}

		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
		const pagination = section.querySelector('.apt-pagination');
		if (pagination) {
			pagination.style.display = 'flex';
			renderPagination(type, 1, totalPages);
			showPage(type, 1, perPage);
		}
	}

	// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
	function showPage(type, page, perPage) {
		const section = document.querySelector(`[data-type-section="${type}"]`);
		if (!section) return;

		const cards = section.querySelectorAll('.apartment-card');
		const start = (page - 1) * perPage;
		const end = start + perPage;

		cards.forEach((card, index) => {
			if (index >= start && index < end) {
				card.style.display = 'block';
			} else {
				card.style.display = 'none';
			}
		});

		// –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∞—á–∞–ª—É —Å–µ–∫—Ü–∏–∏
		section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
	}

	// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
	function renderPagination(type, currentPage, totalPages) {
		const pagination = document.querySelector(`[data-type-pagination="${type}"]`);
		if (!pagination) return;

		let html = '';

		// –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
		if (currentPage > 1) {
			html += `<button onclick="changePage('${type}', ${currentPage - 1})" style="padding: 8px 12px; border: 1px solid #e5e7eb; background: white; color: #374151; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;"><i class="fas fa-chevron-left"></i></button>`;
		}

		const pageButtons = buildPageButtons(currentPage, totalPages);
		pageButtons.forEach(item => {
			if (item === 'ellipsis') {
				html += `<span style="padding: 8px 6px; color: #9ca3af; font-size: 14px;">‚Ä¶</span>`;
				return;
			}

			if (item === currentPage) {
				html += `<button style="padding: 8px 12px; border: 2px solid #2563eb; background: #2563eb; color: white; border-radius: 6px; font-weight: 600; font-size: 14px;">${item}</button>`;
			} else {
				html += `<button onclick="changePage('${type}', ${item})" style="padding: 8px 12px; border: 1px solid #e5e7eb; background: white; color: #374151; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;">${item}</button>`;
			}
		});

		// –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
		if (currentPage < totalPages) {
			html += `<button onclick="changePage('${type}', ${currentPage + 1})" style="padding: 8px 12px; border: 1px solid #e5e7eb; background: white; color: #374151; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s;"><i class="fas fa-chevron-right"></i></button>`;
		}

		pagination.innerHTML = html;
	}

	function buildPageButtons(currentPage, totalPages) {
		const maxMiddlePages = 4;
		const pages = [];

		if (totalPages <= maxMiddlePages + 2) {
			for (let i = 1; i <= totalPages; i++) {
				pages.push(i);
			}
			return pages;
		}

		pages.push(1);

		let left = currentPage - 2;
		let right = currentPage + 2;

		if (left <= 2) {
			left = 2;
			right = Math.min(totalPages - 1, left + (maxMiddlePages - 1));
		}

		if (right >= totalPages - 1) {
			right = totalPages - 1;
			left = Math.max(2, right - (maxMiddlePages - 1));
		}

		if (left > 2) {
			pages.push('ellipsis');
		}

		for (let i = left; i <= right; i++) {
			pages.push(i);
		}

		if (right < totalPages - 1) {
			pages.push('ellipsis');
		}

		pages.push(totalPages);

		return pages;
	}

	// –°–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
	function changePage(type, page) {
		const section = document.querySelector(`[data-type-section="${type}"]`);
		if (!section) return;

		const cards = section.querySelectorAll('.apartment-card');
		const totalPages = Math.ceil(cards.length / 6);

		renderPagination(type, page, totalPages);
		showPage(type, page, 6);
	}

	// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ —Ñ–æ—Ç–æ (–∫–∞–∫ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ)
	window.changeImage = function (button, direction) {
		const gallery = button.parentElement;
		const images = gallery.querySelectorAll('.gallery-image');
		const dots = gallery.querySelectorAll('.dot');
		let currentIndex = 0;

		// –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
		images.forEach((img, i) => {
			if (img.style.display === 'block') {
				currentIndex = i;
			}
		});

		// –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
		let newIndex = currentIndex + direction;
		if (newIndex < 0) newIndex = images.length - 1;
		if (newIndex >= images.length) newIndex = 0;

		// –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
		images[currentIndex].style.display = 'none';
		images[newIndex].style.display = 'block';

		// –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–æ—á–∫–∏
		if (dots.length > 0) {
			dots[currentIndex].classList.remove('active');
			dots[newIndex].classList.add('active');
		}
	}

	window.setImage = function (dot, index) {
		const gallery = dot.parentElement.parentElement;
		const images = gallery.querySelectorAll('.gallery-image');
		const dots = gallery.querySelectorAll('.dot');

		// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
		images.forEach(img => img.style.display = 'none');
		// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ
		if (images[index]) images[index].style.display = 'block';

		// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–∫–∏
		dots.forEach((d, i) => {
			if (i === index) {
				d.classList.add('active');
			} else {
				d.classList.remove('active');
			}
		});
	}

	// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
	document.addEventListener('DOMContentLoaded', function () {
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–∏–ø–∞
		const firstBtn = document.querySelector('.apt-filter-btn');
		if (firstBtn) {
			const firstType = firstBtn.dataset.type;
			initializePagination(firstType);
		}
	});


	// Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞
	document.addEventListener('DOMContentLoaded', function () {
		const filterBtns = document.querySelectorAll('.apt-filter-btn');
		filterBtns.forEach(btn => {
			btn.addEventListener('mouseenter', function () {
				if (!this.classList.contains('active')) {
					this.style.borderColor = '#2563eb';
					this.style.color = '#2563eb';
				}
			});
			btn.addEventListener('mouseleave', function () {
				if (!this.classList.contains('active')) {
					this.style.borderColor = '#e5e7eb';
					this.style.color = '#374151';
				}
			});
		});

		// Hover –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–≤–∞—Ä—Ç–∏—Ä
		const aptCards = document.querySelectorAll('.apartment-card');
		aptCards.forEach(card => {
			card.addEventListener('mouseenter', function () {
				this.style.transform = 'translateY(-4px)';
				this.style.boxShadow = '0 12px 24px rgba(0,0,0,0.15)';
			});
			card.addEventListener('mouseleave', function () {
				this.style.transform = 'translateY(0)';
				this.style.boxShadow = 'none';
			});
		});
	});

	{% endif %}
</script>

<style>
	/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ —Ö–æ–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ */
	.construction-stage-card {
		background: white;
		border-radius: 16px;
		overflow: hidden;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	.construction-stage-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
	}

	.stage-header {
		background: linear-gradient(135deg, var(--c21-gold), #d4af37);
		color: white;
		padding: 12px 16px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		min-height: 60px;
	}

	.stage-number {
		font-size: 16px;
		font-weight: 700;
		flex: 1;
		margin-right: 12px;
	}

	.stage-date {
		font-size: 12px;
		opacity: 0.9;
		text-align: right;
		line-height: 1.3;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		max-width: 180px;
	}

	.stage-photos-container {
		position: relative;
		min-height: 200px;
	}

	.stage-photos {
		position: relative;
		height: 200px;
		overflow: hidden;
	}

	.stage-photo {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: opacity 0.3s ease;
	}

	.stage-photos-nav {
		position: absolute;
		top: 50%;
		transform: translateY(-50%);
		background: rgba(0, 0, 0, 0.6);
		color: white;
		border: none;
		width: 36px;
		height: 36px;
		border-radius: 50%;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.3s ease;
		opacity: 0;
	}

	.stage-photos-container:hover .stage-photos-nav {
		opacity: 1;
	}

	.stage-photos-nav:hover {
		background: rgba(0, 0, 0, 0.8);
		transform: translateY(-50%) scale(1.1);
	}

	.stage-photos-nav.prev {
		left: 10px;
	}

	.stage-photos-nav.next {
		right: 10px;
	}

	.stage-photos-dots {
		position: absolute;
		bottom: 10px;
		left: 50%;
		transform: translateX(-50%);
		display: flex;
		gap: 6px;
	}

	.stage-photos-dot {
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background: rgba(255, 255, 255, 0.5);
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.stage-photos-dot.active {
		background: white;
		transform: scale(1.2);
	}

	.stage-no-photos {
		height: 200px;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		color: #999;
		background: #f8f9fa;
	}

	.stage-no-photos i {
		font-size: 32px;
		margin-bottom: 8px;
		opacity: 0.5;
	}

	.pagination-btn:disabled {
		background: #ddd !important;
		color: #999 !important;
		cursor: not-allowed !important;
	}

	.pagination-btn:hover:not(:disabled) {
		background: #A19276 !important;
		transform: translateY(-2px);
	}

	.advanced-pagination {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 12px;
		margin-top: 16px;
		flex-wrap: wrap;
	}

	.advanced-pagination .pagination-btn {
		background: #BEAF87;
		color: white;
		border: none;
		padding: 8px 12px;
		border-radius: 8px;
		cursor: pointer;
		font-weight: 600;
		display: flex;
		align-items: center;
		gap: 4px;
	}

	.advanced-pagination .pagination-btn:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.advanced-pagination .pagination-pages {
		display: flex;
		align-items: center;
		gap: 8px;
		flex-wrap: wrap;
	}

	.advanced-pagination .pagination-page {
		min-width: 32px;
		height: 32px;
		border-radius: 8px;
		display: flex;
		justify-content: center;
		align-items: center;
		background: #f3f4f6;
		color: #111827;
		font-weight: 600;
		cursor: pointer;
		border: 1px solid transparent;
		padding: 0 6px;
	}

	.advanced-pagination .pagination-page.active {
		background: #BEAF87;
		color: white;
		border-color: #A19276;
	}

	/* –ê–∫—Ü–∏–∏ */
	.complex-offers-section .offers-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
		gap: 20px;
		justify-items: center;
	}

	.offer-card {
		width: 100%;
		max-width: 620px;
		display: flex;
		gap: 16px;
		background: #fff;
		border: 1px solid #efe7ce;
		border-radius: 16px;
		padding: 16px;
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
		transition: box-shadow 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
		text-decoration: none;
		color: inherit;
	}

	.offer-card:hover {
		box-shadow: 0 16px 36px rgba(0, 0, 0, 0.14);
		transform: translateY(-2px);
		border-color: #BEAF87;
	}

	.offer-media {
		flex: 0 0 200px;
		position: relative;
		border-radius: 12px;
		overflow: hidden;
		aspect-ratio: 16/10;
		min-height: 120px;
	}

	.offer-media img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	.offer-media::after {
		content: '';
		position: absolute;
		inset: 0;
		background: linear-gradient(180deg, rgba(0, 0, 0, 0) 40%, rgba(0, 0, 0, 0.18) 100%);
	}

	.offer-content {
		flex: 1;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		min-height: 120px;
	}

	.offer-head {
		display: flex;
		align-items: flex-start;
		gap: 8px;
		flex-wrap: wrap;
		margin-bottom: 8px;
	}

	.offer-chip {
		display: inline-block;
		background: #252526;
		color: #BEAF87;
		padding: 3px 8px;
		border-radius: 999px;
		font-weight: 700;
		font-size: 11px;
		white-space: nowrap;
	}

	.offer-limited {
		display: flex;
		align-items: center;
		gap: 6px;
		color: #7b6a3e;
		background: #faf7ee;
		border: 1px solid #efe7ce;
		border-radius: 8px;
		padding: 6px 8px;
		margin-top: 8px;
		font-weight: 600;
		font-size: 12px;
	}

	.offer-actions {
		display: flex;
		gap: 8px;
		align-items: center;
		flex-wrap: wrap;
		margin-top: 10px;
		justify-content: flex-start;
	}

	.offer-cta {
		flex: none;
		text-align: center;
		padding: 8px 16px !important;
		border-radius: 8px;
		background: linear-gradient(180deg, #BEAF87, #A19276) !important;
		color: #252526 !important;
		border: none !important;
		box-shadow: 0 4px 12px rgba(190, 175, 135, 0.45);
		font-size: 13px;
		font-weight: 700;
		min-width: 140px;
	}

	.offer-cta:hover {
		filter: brightness(.98);
		transform: translateY(-1px);
	}

	.advanced-pagination .pagination-page.ellipsis {
		cursor: default;
		background: transparent;
		color: #9ca3af;
		border: none;
	}

	/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
	@media (max-width: 768px) {
		.construction-stages-grid {
			grid-template-columns: 1fr !important;
			gap: 16px !important;
		}

		.advanced-pagination {
			flex-wrap: nowrap;
			justify-content: center;
			gap: 8px !important;
		}

		.pagination-btn,
		.advanced-pagination .pagination-btn {
			width: auto;
			min-width: 44px;
			max-width: none;
		}

		.advanced-pagination .pagination-pages {
			flex: 1;
			justify-content: center;
		}

		.stage-header {
			flex-direction: column;
			gap: 8px;
			text-align: center;
		}

		.offer-card {
			flex-direction: column;
		}

		.offer-media {
			flex: none;
			width: 100%;
		}

		.offer-actions {
			justify-content: center;
			width: 100%;
		}

		.offer-cta {
			width: 100%;
		}
	}

	/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è MongoDB –≤–µ—Ä—Å–∏–∏ */
	{% if is_mongodb %}

	.apartment-card {
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
	}

	.apt-filter-btn:hover {
		transform: translateY(-2px);
	}

	.gallery-item:hover img {
		transform: scale(1.05);
	}

	.no-apartments-cta {
		grid-column: 1 / -1;
		padding: 32px;
		background: #f8fafc;
		border: 1px solid #e5e7eb;
		border-radius: 16px;
		text-align: center;
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 12px;
		color: #1f2937;
	}

	.no-apartments-icon {
		width: 80px;
		height: 80px;
		border-radius: 50%;
		background: #e0f2fe;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 36px;
	}

	.no-apartments-cta h3 {
		font-size: 20px;
		font-weight: 700;
		margin: 0;
	}

	.no-apartments-cta p {
		margin: 0;
		font-size: 15px;
		color: #4b5563;
		max-width: 420px;
	}

	.no-apartments-btn {
		margin-top: 8px;
		padding: 12px 28px;
		background: linear-gradient(135deg, #BEAF87, #A19276);
		color: #252526;
		border: none;
		border-radius: 999px;
		font-size: 15px;
		font-weight: 600;
		cursor: pointer;
		box-shadow: 0 8px 24px rgba(190, 175, 135, 0.4);
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

	.no-apartments-btn:hover {
		transform: translateY(-2px);
		box-shadow: 0 12px 32px rgba(190, 175, 135, 0.5);
	}

	@media (max-width: 768px) {
		.apartments-grid {
			grid-template-columns: 1fr !important;
		}

		.apartment-types-filter {
			overflow-x: auto;
			flex-wrap: nowrap !important;
		}

		.apt-filter-btn {
			white-space: nowrap;
		}
	}

	{% endif %}
</style>

<!-- JavaScript –¥–ª—è —Å–µ–∫—Ü–∏–∏ —Ö–æ–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ -->
{% if is_mongodb and complex.construction_progress and complex.construction_progress.construction_stages %}
{{ complex.construction_progress.construction_stages|json_script:"construction-stages-data" }}
<script>
	document.addEventListener('DOMContentLoaded', function () {
		const stagesDataEl = document.getElementById('construction-stages-data');
		let stages = [];
		if (stagesDataEl) {
			try {
				stages = JSON.parse(stagesDataEl.textContent);
			} catch (err) {
				console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö —Ö–æ–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞:', err);
				stages = [];
			}
		}
		if (!stages.length) {
			console.warn('–î–∞–Ω–Ω—ã–µ —Ö–æ–¥–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∏—Ö –∑–∞–≥—Ä—É–∑–∏—Ç—å');
			return;
		}

		const stagesPerPage = 3;
		let currentPage = 0;
		const totalPages = Math.max(1, Math.ceil(stages.length / stagesPerPage));

		const prevBtnTop = document.getElementById('prevStagesBtn');
		const nextBtnTop = document.getElementById('nextStagesBtn');
		const prevBtnBottom = document.getElementById('prevStagesBtnBottom');
		const nextBtnBottom = document.getElementById('nextStagesBtnBottom');
		const stagesGrid = document.getElementById('constructionStagesGrid');
		const topPaginationContainer = document.getElementById('topPaginationPages');
		const bottomPaginationContainer = document.getElementById('bottomPaginationPages');

	// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —ç—Ç–∞–ø–∞
	function createStageCard(stage) {
		const photos = stage.photos || [];
		const photoHtml = photos.length > 0 ? photos.map((photo, index) => {
			const photoUrl = photo.startsWith('http') ? photo : `/media/${photo}`;
			return `<img src="${photoUrl}" alt="–≠—Ç–∞–ø ${stage.stage_number}" class="stage-photo" style="display: ${index === 0 ? 'block' : 'none'};">`;
		}).join('') : '';

		const navigationHtml = photos.length > 1 ? `
            <button class="stage-photos-nav prev" onclick="changeStagePhoto(this, -1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="stage-photos-nav next" onclick="changeStagePhoto(this, 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
            <div class="stage-photos-dots">
                ${photos.map((_, index) =>
			`<span class="stage-photos-dot ${index === 0 ? 'active' : ''}" onclick="setStagePhoto(this, ${index})"></span>`
		).join('')}
            </div>
        ` : '';

		const noPhotosHtml = photos.length === 0 ? `
            <div class="stage-no-photos">
                <i class="fas fa-image"></i>
                <span>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</span>
            </div>
        ` : '';

		return `
            <div class="construction-stage-card">
                <div class="stage-header">
                    <div class="stage-number">–≠—Ç–∞–ø ${stage.stage_number}</div>
                    <div class="stage-date" title="${stage.date}">${stage.date}</div>
                </div>
                <div class="stage-photos-container">
                    ${photos.length > 0 ? `
                        <div class="stage-photos">
                            ${photoHtml}
                            ${navigationHtml}
                        </div>
                    ` : noPhotosHtml}
                </div>
            </div>
        `;
	}

	// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤
	function updateStagesDisplay() {
		const startIndex = currentPage * stagesPerPage;
		const endIndex = Math.min(startIndex + stagesPerPage, stages.length);
		const currentStages = stages.slice(startIndex, endIndex);

		stagesGrid.innerHTML = currentStages.map(stage => createStageCard(stage)).join('');

		// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
		const isFirstPage = currentPage === 0;
		const isLastPage = currentPage === totalPages - 1;

		[prevBtnTop, prevBtnBottom].forEach(btn => {
			if (btn) btn.disabled = isFirstPage;
		});

		[nextBtnTop, nextBtnBottom].forEach(btn => {
			if (btn) btn.disabled = isLastPage;
		});

		// –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
		updatePagination();
	}

	// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
	function getPaginationPages() {
		const pages = [];
		const maxVisible = 5;
		const firstPage = 0;
		const lastPage = totalPages - 1;

		if (totalPages <= maxVisible) {
			for (let i = 0; i < totalPages; i++) {
				pages.push(i);
			}
			return pages;
		}

		pages.push(firstPage);

		let start = Math.max(currentPage - 1, firstPage + 1);
		let end = Math.min(currentPage + 1, lastPage - 1);

		if (start - firstPage > 1) {
			pages.push('ellipsis-left');
		} else {
			start = firstPage + 1;
		}

		if (lastPage - end > 1) {
			// keep end as is
		} else {
			end = lastPage - 1;
		}

		for (let i = start; i <= end; i++) {
			if (i > firstPage && i < lastPage) {
				pages.push(i);
			}
		}

		if (lastPage - end > 1) {
			pages.push('ellipsis-right');
		}

		if (lastPage !== firstPage) {
			pages.push(lastPage);
		}

		return pages;
	}

	function renderPagination(container) {
		if (!container) return;
		container.innerHTML = '';

		const pages = getPaginationPages();

		pages.forEach(page => {
			if (typeof page === 'string' && page.startsWith('ellipsis')) {
				const ellipsis = document.createElement('span');
				ellipsis.className = 'pagination-page ellipsis';
				ellipsis.textContent = '...';
				container.appendChild(ellipsis);
			} else {
				const pageBtn = document.createElement('button');
				pageBtn.type = 'button';
				pageBtn.className = `pagination-page ${page === currentPage ? 'active' : ''}`;
				pageBtn.textContent = page + 1;
				pageBtn.onclick = () => goToPage(page);
				container.appendChild(pageBtn);
			}
		});
	}

	function updatePagination() {
		renderPagination(topPaginationContainer);
		renderPagination(bottomPaginationContainer);
	}

	// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
	function goToPage(page) {
		if (page >= 0 && page < totalPages) {
			currentPage = page;
			updateStagesDisplay();
		}
	}

	// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
	// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
	[prevBtnTop, prevBtnBottom].forEach(btn => {
		if (btn) {
			btn.addEventListener('click', () => {
				if (currentPage > 0) {
					currentPage--;
					updateStagesDisplay();
				}
			});
		}
	});

	[nextBtnTop, nextBtnBottom].forEach(btn => {
		if (btn) {
			btn.addEventListener('click', () => {
				if (currentPage < totalPages - 1) {
					currentPage++;
					updateStagesDisplay();
				}
			});
		}
	});

	// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
	updateStagesDisplay();

	// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ñ–ö
	if (window.UserTracking && typeof window.UserTracking.trackComplexView === 'function') {
		const complexId = '{{ complex.id }}';
		const complexName = '{{ complex.name|escapejs }}';
		if (complexId && complexName) {
			window.UserTracking.trackComplexView(complexId, complexName);
		}
	}

	// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–±—Ä–∞–Ω–Ω–æ–º
	window.showFavoriteNotification = function (message) {
		const notification = document.createElement('div');
		notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--c21-gold);
            color: var(--c21-dark);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            font-weight: 600;
            animation: slideInRight 0.3s ease;
        `;
		notification.textContent = message;
		document.body.appendChild(notification);

		setTimeout(() => {
			notification.style.animation = 'slideOutRight 0.3s ease';
			setTimeout(() => notification.remove(), 300);
		}, 2000);
	};

	// –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
	if (!document.getElementById('favorite-notification-styles')) {
		const style = document.createElement('style');
		style.id = 'favorite-notification-styles';
		style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
		document.head.appendChild(style);
	}

	// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º
	window.changeStagePhoto = function (button, direction) {
		const card = button.closest('.construction-stage-card');
		const photos = card.querySelectorAll('.stage-photo');
		const dots = card.querySelectorAll('.stage-photos-dot');

		let currentIndex = 0;
		photos.forEach((photo, index) => {
			if (photo.style.display === 'block') {
				currentIndex = index;
			}
		});

		const newIndex = (currentIndex + direction + photos.length) % photos.length;

		photos[currentIndex].style.display = 'none';
		photos[newIndex].style.display = 'block';

		dots[currentIndex].classList.remove('active');
		dots[newIndex].classList.add('active');
	};

	window.setStagePhoto = function (dot, index) {
		const card = dot.closest('.construction-stage-card');
		const photos = card.querySelectorAll('.stage-photo');
		const dots = card.querySelectorAll('.stage-photos-dot');

		photos.forEach(photo => photo.style.display = 'none');
		photos[index].style.display = 'block';

		dots.forEach(d => d.classList.remove('active'));
		dots[index].classList.add('active');
	};
});
</script>
{% endif %}

{% endblock %}