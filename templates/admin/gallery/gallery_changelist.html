{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<script>
console.log('CUSTOM TEMPLATE IS LOADED!');
console.log('Template path:', '{{ request.path }}');

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing gallery interface...');
    
    const contentTypeSelect = document.getElementById('content-type');
    const categorySelect = document.getElementById('category');
    const toggleButton = document.getElementById('toggle-view');
    const galleryInterface = document.querySelector('.gallery-interface');
    
    let showingStandardView = false;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∏–¥–∞–º–∏
    toggleButton.addEventListener('click', function() {
        if (showingStandardView) {
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            galleryInterface.style.display = 'block';
            document.getElementById('result_list').style.display = 'none';
            document.querySelector('.actions').style.display = 'none';
            document.querySelector('.paginator').style.display = 'none';
            toggleButton.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫';
            toggleButton.style.background = '#6c757d';
            showingStandardView = false;
        } else {
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫
            galleryInterface.style.display = 'none';
            const resultList = document.getElementById('result_list');
            const actions = document.querySelector('.actions');
            const paginator = document.querySelector('.paginator');
            
            if (resultList) resultList.style.display = 'block';
            if (actions) actions.style.display = 'block';
            if (paginator) paginator.style.display = 'block';
            
            toggleButton.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å';
            toggleButton.style.background = '#007bff';
            showingStandardView = true;
        }
    });
    
    const objectsContainer = document.getElementById('objects-container');
    const objectsList = document.getElementById('objects-list');
    const existingContent = document.getElementById('existing-content');
    const contentList = document.getElementById('content-list');
    const uploadSection = document.getElementById('upload-section');
    const videoFields = document.getElementById('video-fields');
         const fileInput = document.getElementById('file-input');
     const uploadArea = document.getElementById('upload-area');
     const messages = document.getElementById('messages');
     const selectedFiles = document.getElementById('selected-files');
     const filesList = document.getElementById('files-list');
    
    console.log('Elements found:', {
        contentTypeSelect: !!contentTypeSelect,
        categorySelect: !!categorySelect,
        objectsContainer: !!objectsContainer,
        objectsList: !!objectsList,
        existingContent: !!existingContent,
        contentList: !!contentList,
        uploadSection: !!uploadSection,
        videoFields: !!videoFields,
        fileInput: !!fileInput,
        uploadArea: !!uploadArea,
        messages: !!messages
    });
    
         let selectedObjectId = null;
     
     // –§—É–Ω–∫—Ü–∏—è —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
     function transliterate(text) {
         const translitMap = {
             '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo',
             '–∂': 'zh', '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm',
             '–Ω': 'n', '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u',
             '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts', '—á': 'ch', '—à': 'sh', '—â': 'sch',
             '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya',
             '–ê': 'A', '–ë': 'B', '–í': 'V', '–ì': 'G', '–î': 'D', '–ï': 'E', '–Å': 'Yo',
             '–ñ': 'Zh', '–ó': 'Z', '–ò': 'I', '–ô': 'Y', '–ö': 'K', '–õ': 'L', '–ú': 'M',
             '–ù': 'N', '–û': 'O', '–ü': 'P', '–†': 'R', '–°': 'S', '–¢': 'T', '–£': 'U',
             '–§': 'F', '–•': 'H', '–¶': 'Ts', '–ß': 'Ch', '–®': 'Sh', '–©': 'Sch',
             '–™': '', '–´': 'Y', '–¨': '', '–≠': 'E', '–Æ': 'Yu', '–Ø': 'Ya'
         };
         
         return text
             .split('')
             .map(char => translitMap[char] || char)
             .join('')
             .toLowerCase()
             .replace(/[^a-z0-9\s-]/g, '')
             .replace(/\s+/g, '-')
             .replace(/-+/g, '-')
             .replace(/^-|-$/g, '');
     }
     
     // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
     function formatFileSize(bytes) {
         if (bytes === 0) return '0 Bytes';
         const k = 1024;
         const sizes = ['Bytes', 'KB', 'MB', 'GB'];
         const i = Math.floor(Math.log(bytes) / Math.log(k));
         return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
     }
     
           // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
      function displaySelectedFiles() {
          const files = fileInput.files;
          if (files.length > 0) {
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
              const checkedIndexes = [];
              document.querySelectorAll('.main-checkbox:checked').forEach(checkbox => {
                  checkedIndexes.push(parseInt(checkbox.dataset.index));
              });
              
              filesList.innerHTML = '';
              Array.from(files).forEach((file, index) => {
                  const fileItem = document.createElement('div');
                  fileItem.className = 'file-item';
                  fileItem.dataset.index = index;
                 
                 // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é
                 const preview = document.createElement('div');
                 preview.className = 'file-preview';
                 
                 if (file.type.startsWith('image/')) {
                     // –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                     const img = document.createElement('img');
                     img.style.width = '100%';
                     img.style.height = '100%';
                     img.style.objectFit = 'cover';
                     img.style.borderRadius = '8px';
                     img.onload = function() {
                         preview.appendChild(img);
                     };
                     img.onerror = function() {
                         preview.innerHTML = 'üñºÔ∏è';
                         preview.style.fontSize = '24px';
                         preview.style.display = 'flex';
                         preview.style.alignItems = 'center';
                         preview.style.justifyContent = 'center';
                     };
                     img.src = URL.createObjectURL(file);
                 } else if (file.type.startsWith('video/')) {
                     // –î–ª—è –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                     preview.innerHTML = '‚ö†Ô∏è';
                     preview.style.fontSize = '24px';
                     preview.style.display = 'flex';
                     preview.style.alignItems = 'center';
                     preview.style.justifyContent = 'center';
                     preview.style.color = '#dc3545';
                     
                     // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                     const warning = document.createElement('div');
                     warning.style.color = '#dc3545';
                     warning.style.fontSize = '12px';
                     warning.style.marginTop = '5px';
                     warning.textContent = '–í–∏–¥–µ–æ —Ñ–∞–π–ª—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube/Rutube.';
                     fileInfo.appendChild(warning);
                 } else {
                     // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∫–æ–Ω–∫—É
                     preview.innerHTML = 'üìÑ';
                     preview.style.fontSize = '24px';
                     preview.style.display = 'flex';
                     preview.style.alignItems = 'center';
                     preview.style.justifyContent = 'center';
                 }
                 
                 // –°–æ–∑–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                 const fileInfo = document.createElement('div');
                 fileInfo.className = 'file-info';
                 
                 const name = document.createElement('div');
                 name.className = 'file-name';
                 name.textContent = file.name;
                 
                 const size = document.createElement('div');
                 size.className = 'file-size';
                 size.textContent = formatFileSize(file.size);
                 
                                                                       // –ü–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
                  const titleInputContainer = document.createElement('div');
                  titleInputContainer.className = 'title-input-container';
                  
                  const titleLabel = document.createElement('label');
                  titleLabel.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ:';
                  titleLabel.className = 'file-field-label';
                  
                  const titleInput = document.createElement('input');
                  titleInput.type = 'text';
                  titleInput.className = 'file-title-input';
                  titleInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞';
                  titleInput.dataset.index = index;
                  
                  // –ü–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
                  const descriptionInputContainer = document.createElement('div');
                  descriptionInputContainer.className = 'description-input-container';
                  
                  const descriptionLabel = document.createElement('label');
                  descriptionLabel.textContent = '–û–ø–∏—Å–∞–Ω–∏–µ:';
                  descriptionLabel.className = 'file-field-label';
                  
                  const descriptionInput = document.createElement('textarea');
                  descriptionInput.className = 'file-description-input';
                  descriptionInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞';
                  descriptionInput.rows = 2;
                  descriptionInput.dataset.index = index;
                  
                  // –ü–æ–ª–µ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞
                  const fileNamePreview = document.createElement('div');
                  fileNamePreview.className = 'file-name-preview';
                  fileNamePreview.innerHTML = `<strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç:</strong> <em>–≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã—à–µ</em>`;
                  
                  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
                  titleInput.addEventListener('input', function() {
                      const title = this.value;
                      const transliteratedTitle = title ? transliterate(title) : '';
                      
                      if (transliteratedTitle) {
                          fileNamePreview.innerHTML = `<strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç:</strong> ${transliteratedTitle}`;
                      } else {
                          fileNamePreview.innerHTML = `<strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç:</strong> <em>–≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã—à–µ</em>`;
                      }
                  });
                 
                                   // –ß–µ–∫–±–æ–∫—Å "–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è/–≤–∏–¥–µ–æ"
                  const mainCheckboxContainer = document.createElement('div');
                  mainCheckboxContainer.className = 'main-checkbox-container';
                  
                  const mainCheckbox = document.createElement('input');
                  mainCheckbox.type = 'checkbox';
                  mainCheckbox.id = `main-checkbox-${index}`;
                  mainCheckbox.className = 'main-checkbox';
                  mainCheckbox.dataset.index = index;
                  
                  const mainLabel = document.createElement('label');
                  mainLabel.htmlFor = `main-checkbox-${index}`;
                  mainLabel.className = 'main-checkbox-label';
                  mainLabel.innerHTML = '‚≠ê –ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è/–≤–∏–¥–µ–æ';
                  
                  mainCheckboxContainer.appendChild(mainCheckbox);
                  mainCheckboxContainer.appendChild(mainLabel);
                  
                                     // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è"
                   mainCheckbox.addEventListener('change', function() {
                       if (this.checked) {
                           // –°–Ω–∏–º–∞–µ–º –≥–∞–ª–æ—á–∫–∏ —Å–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
                           document.querySelectorAll('.main-checkbox').forEach(checkbox => {
                               if (checkbox !== this) {
                                   checkbox.checked = false;
                               }
                           });
                       }
                   });
                   
                   // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
                   const deleteButton = document.createElement('button');
                   deleteButton.className = 'delete-file-btn';
                   deleteButton.innerHTML = 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å';
                   deleteButton.onclick = function() {
                       removeFile(index);
                   };
                   
                   // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                   titleInputContainer.appendChild(titleLabel);
                   titleInputContainer.appendChild(titleInput);
                   
                   descriptionInputContainer.appendChild(descriptionLabel);
                   descriptionInputContainer.appendChild(descriptionInput);
                   
                   fileInfo.appendChild(name);
                   fileInfo.appendChild(size);
                   fileInfo.appendChild(titleInputContainer);
                   fileInfo.appendChild(descriptionInputContainer);
                   fileInfo.appendChild(fileNamePreview);
                   fileInfo.appendChild(mainCheckboxContainer);
                   fileInfo.appendChild(deleteButton);
                  
                  fileItem.appendChild(preview);
                  fileItem.appendChild(fileInfo);
                  filesList.appendChild(fileItem);
              });
              
              // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
              checkedIndexes.forEach(checkedIndex => {
                  const checkbox = document.querySelector(`.main-checkbox[data-index="${checkedIndex}"]`);
                  if (checkbox) {
                      checkbox.checked = true;
                  }
              });
              
              selectedFiles.style.display = 'block';
          } else {
              selectedFiles.style.display = 'none';
          }
      }
     
     // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
     function removeFile(index) {
         const dt = new DataTransfer();
         const files = fileInput.files;
         
         for (let i = 0; i < files.length; i++) {
             if (i !== index) {
                 dt.items.add(files[i]);
             }
         }
         
         fileInput.files = dt.files;
         displaySelectedFiles();
     }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    contentTypeSelect.addEventListener('change', function() {
        console.log('Content type changed to:', this.value);
        if (this.value === 'video') {
            videoFields.classList.add('show');
            uploadArea.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ
        } else {
            videoFields.classList.remove('show');
            uploadArea.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        }
        
        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –æ–±—ä–µ–∫—Ç, –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞
        if (selectedObjectId) {
            loadExistingContent();
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    categorySelect.addEventListener('change', function() {
        console.log('Category changed:', this.value);
        selectedObjectId = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        if (this.value) {
            loadObjects(this.value);
        } else {
            objectsContainer.style.display = 'none';
            existingContent.style.display = 'none';
            uploadSection.style.display = 'none';
        }
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function loadObjects(category) {
        console.log('Loading objects for category:', category);
        objectsContainer.style.display = 'block';
        objectsList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤...</div>';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        existingContent.style.display = 'none';
        uploadSection.style.display = 'none';
        
        fetch(`/admin/main/gallery/get-objects/?category=${category}`)
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Objects data:', data);
                objectsList.innerHTML = '';
                if (data.success && data.objects && data.objects.length > 0) {
                    console.log('Found objects:', data.objects);
                    data.objects.forEach(obj => {
                        const item = document.createElement('div');
                        item.className = 'object-item';
                        item.dataset.id = obj.id;
                        item.textContent = obj.name;
                        item.addEventListener('click', () => selectObject(obj.id, obj.name));
                        objectsList.appendChild(item);
                    });
                } else {
                    objectsList.innerHTML = '<div class="error">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</div>';
                }
            })
            .catch(error => {
                console.error('Error loading objects:', error);
                objectsList.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤: ' + error.message + '</div>';
            });
    }
    
    // –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞
    function selectObject(id, name) {
        console.log('Selecting object:', { id, name });
        selectedObjectId = id;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
        document.querySelectorAll('.object-item').forEach(item => {
            item.classList.remove('selected');
        });
        
        // –ù–∞—Ö–æ–¥–∏–º –∏ –≤—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
        const selectedElement = document.querySelector(`[data-id="${id}"]`);
        if (selectedElement) {
            selectedElement.classList.add('selected');
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        loadExistingContent();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
        uploadSection.style.display = 'block';
    }
    
         // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
     function loadExistingContent() {
         if (!selectedObjectId) return;
         
         const category = categorySelect.value;
         const contentType = contentTypeSelect.value;
         
         console.log('Loading existing content for:', { category, objectId: selectedObjectId, contentType });
         
         existingContent.style.display = 'block';
         contentList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...</div>';
         
         fetch(`/admin/main/gallery/get-content/?category=${category}&object_id=${selectedObjectId}&content_type=${contentType}`)
             .then(response => {
                 if (!response.ok) {
                     throw new Error(`HTTP error! status: ${response.status}`);
                 }
                 return response.json();
             })
             .then(data => {
                 console.log('Received data:', data);
                 contentList.innerHTML = '';
                 
                 if (data.success === false) {
                     contentList.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${data.error}</div>`;
                     return;
                 }
                 
                 if (data.content && data.content.length > 0) {
                     console.log('Found content items:', data.content.length);
                     // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤
                     const existingFilesGrid = document.createElement('div');
                     existingFilesGrid.className = 'existing-files-grid';
                     
                     data.content.forEach((item, index) => {
                         console.log('Processing item:', item); // Debug log
                         console.log('Item video_url:', item.video_url); // Debug video URL
                         console.log('Item content_type:', item.content_type); // Debug content type
                         // –£–±—Ä–∞–Ω–æ - –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤
                         const existingFileItem = document.createElement('div');
                         existingFileItem.className = 'existing-file-item';
                         existingFileItem.dataset.id = item.id;
                         existingFileItem.dataset.index = index;
                         
                         // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é
                         const preview = document.createElement('div');
                         preview.className = 'existing-file-preview';
                         
                         if (item.content_type === 'image' && item.image_url) {
                             const img = document.createElement('img');
                             img.style.width = '100%';
                             img.style.height = '100%';
                             img.style.objectFit = 'cover';
                             img.style.borderRadius = '8px';
                             img.onload = function() {
                                 preview.appendChild(img);
                             };
                             img.onerror = function() {
                                 preview.innerHTML = 'üñºÔ∏è';
                                 preview.style.fontSize = '48px';
                                 preview.style.display = 'flex';
                                 preview.style.alignItems = 'center';
                                 preview.style.justifyContent = 'center';
                             };
                             img.src = item.image_url;
                         } else if (item.content_type === 'video') {
                             if (item.video_url) {
                                 preview.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background: #000; border-radius: 8px;"><span style="color: white; font-size: 48px;">‚ñ∂Ô∏è</span></div>';
                             } else {
                                 preview.innerHTML = 'üé•';
                                 preview.style.fontSize = '48px';
                                 preview.style.display = 'flex';
                                 preview.style.alignItems = 'center';
                                 preview.style.justifyContent = 'center';
                             }
                         } else {
                             preview.innerHTML = 'üìÑ';
                             preview.style.fontSize = '48px';
                             preview.style.display = 'flex';
                             preview.style.alignItems = 'center';
                             preview.style.justifyContent = 'center';
                         }
                         
                         // –°–æ–∑–¥–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                         const fileInfo = document.createElement('div');
                         fileInfo.className = 'existing-file-info';
                         
                         const name = document.createElement('div');
                         name.className = 'existing-file-name';
                         name.textContent = item.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                         
                         const order = document.createElement('div');
                         order.className = 'existing-file-order';
                         order.textContent = `–ü–æ—Ä—è–¥–æ–∫: ${item.order}`;
                         
                         // –ü–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                         const titleInputContainer = document.createElement('div');
                         titleInputContainer.className = 'title-input-container';
                         
                         const titleLabel = document.createElement('label');
                         titleLabel.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ:';
                         titleLabel.className = 'file-field-label';
                         
                         const titleInput = document.createElement('input');
                         titleInput.type = 'text';
                         titleInput.className = 'file-title-input';
                         titleInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ';
                         console.log('Setting title for item', item.id, ':', item.title);
                         titleInput.value = item.title || '';
                         titleInput.dataset.id = item.id;
                         
                         // –ü–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                         const descriptionInputContainer = document.createElement('div');
                         descriptionInputContainer.className = 'description-input-container';
                         
                         const descriptionLabel = document.createElement('label');
                         descriptionLabel.textContent = '–û–ø–∏—Å–∞–Ω–∏–µ:';
                         descriptionLabel.className = 'file-field-label';
                         
                         const descriptionInput = document.createElement('textarea');
                         descriptionInput.className = 'file-description-input';
                         descriptionInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ';
                         descriptionInput.value = item.description || '';
                         descriptionInput.rows = 2;
                         descriptionInput.dataset.id = item.id;
                         
                         // –ü–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–≤—å—é –≤–∏–¥–µ–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–¥–µ–æ)
                         let thumbnailInputContainer = null;
                         if (item.content_type === 'video') {
                             thumbnailInputContainer = document.createElement('div');
                             thumbnailInputContainer.className = 'thumbnail-input-container';
                             
                             // –ü–æ–ª–µ –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube
                             const videoUrlContainer = document.createElement('div');
                             videoUrlContainer.className = 'video-url-container';
                             
                             const videoUrlLabel = document.createElement('label');
                             videoUrlLabel.textContent = '–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube/Rutube) –∏–ª–∏ iframe –∫–æ–¥:';
                             videoUrlLabel.className = 'file-field-label';
                             
                             const videoUrlInput = document.createElement('input');
                             videoUrlInput.type = 'text';
                             videoUrlInput.className = 'file-video-url-input';
                             videoUrlInput.placeholder = 'https://www.youtube.com/watch?v=... –∏–ª–∏ iframe –∫–æ–¥';
                             videoUrlInput.value = item.video_url || '';
                             videoUrlInput.dataset.id = item.id;
                             
                             // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                             const videoUrlHint = document.createElement('div');
                             videoUrlHint.className = 'field-hint';
                             videoUrlHint.innerHTML = '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: YouTube —Å—Å—ã–ª–∫–∏, Rutube —Å—Å—ã–ª–∫–∏, iframe –∫–æ–¥—ã';
                             videoUrlHint.style.fontSize = '12px';
                             videoUrlHint.style.color = '#666';
                             videoUrlHint.style.marginTop = '4px';
                             
                             videoUrlContainer.appendChild(videoUrlLabel);
                             videoUrlContainer.appendChild(videoUrlInput);
                             videoUrlContainer.appendChild(videoUrlHint);
                             
                             const thumbnailLabel = document.createElement('label');
                             thumbnailLabel.textContent = '–ü—Ä–µ–≤—å—é –≤–∏–¥–µ–æ:';
                             thumbnailLabel.className = 'file-field-label';
                             
                             const thumbnailInput = document.createElement('input');
                             thumbnailInput.type = 'file';
                             thumbnailInput.className = 'file-thumbnail-input';
                             thumbnailInput.accept = 'image/*';
                             thumbnailInput.dataset.id = item.id;
                             
                             // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø—Ä–µ–≤—å—é, –µ—Å–ª–∏ –µ—Å—Ç—å
                             if (item.video_thumbnail_url) {
                                 const currentThumbnail = document.createElement('div');
                                 currentThumbnail.className = 'current-thumbnail';
                                 currentThumbnail.innerHTML = `
                                     <img src="${item.video_thumbnail_url}" alt="–¢–µ–∫—É—â–µ–µ –ø—Ä–µ–≤—å—é" style="max-width: 150px; max-height: 90px; border-radius: 4px;">
                                     <small>–¢–µ–∫—É—â–µ–µ –ø—Ä–µ–≤—å—é</small>
                                 `;
                                 thumbnailInputContainer.appendChild(currentThumbnail);
                             }
                             
                             thumbnailInputContainer.appendChild(videoUrlContainer);
                             thumbnailInputContainer.appendChild(thumbnailLabel);
                             thumbnailInputContainer.appendChild(thumbnailInput);
                         }
                         
                         // –ü–æ–ª–µ —Å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞
                         const fileNamePreview = document.createElement('div');
                         fileNamePreview.className = 'file-name-preview';
                         
                         // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
                         function updateFileNamePreview() {
                             const title = titleInput.value;
                             const transliteratedTitle = title ? transliterate(title) : '';
                             
                             if (transliteratedTitle) {
                                 fileNamePreview.innerHTML = `<strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç:</strong> ${transliteratedTitle}`;
                             } else {
                                 fileNamePreview.innerHTML = `<strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—É–¥–µ—Ç:</strong> <em>–≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã—à–µ</em>`;
                             }
                         }
                         
                         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
                         updateFileNamePreview();
                         
                         // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
                         titleInput.addEventListener('input', updateFileNamePreview);
                         
                         // –ß–µ–∫–±–æ–∫—Å "–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è/–≤–∏–¥–µ–æ"
                         const mainCheckboxContainer = document.createElement('div');
                         mainCheckboxContainer.className = 'main-checkbox-container';
                         
                         const mainCheckbox = document.createElement('input');
                         mainCheckbox.type = 'checkbox';
                         mainCheckbox.id = `existing-main-checkbox-${item.id}`;
                         mainCheckbox.className = 'main-checkbox existing-main-checkbox';
                         mainCheckbox.dataset.id = item.id;
                         mainCheckbox.checked = item.is_main;
                         
                         const mainLabel = document.createElement('label');
                         mainLabel.htmlFor = `existing-main-checkbox-${item.id}`;
                         mainLabel.className = 'main-checkbox-label';
                         mainLabel.innerHTML = '‚≠ê –ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è/–≤–∏–¥–µ–æ';
                         
                         mainCheckboxContainer.appendChild(mainCheckbox);
                         mainCheckboxContainer.appendChild(mainLabel);
                         
                         // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è"
                         mainCheckbox.addEventListener('change', function() {
                             if (this.checked) {
                                 // –°–Ω–∏–º–∞–µ–º –≥–∞–ª–æ—á–∫–∏ —Å–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
                                 document.querySelectorAll('.existing-main-checkbox').forEach(checkbox => {
                                     if (checkbox !== this) {
                                         checkbox.checked = false;
                                     }
                                 });
                             }
                         });
                         
                         // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                         const actionsContainer = document.createElement('div');
                         actionsContainer.className = 'existing-file-actions';
                         
                         const updateButton = document.createElement('button');
                         updateButton.className = 'update-file-btn';
                         updateButton.innerHTML = 'üíæ –û–±–Ω–æ–≤–∏—Ç—å';
                         updateButton.onclick = function() {
                             console.log('Updating file', item.id, 'with title:', titleInput.value);
                             const videoUrlInput = document.querySelector(`input[data-id="${item.id}"].file-video-url-input`);
                             const videoUrl = videoUrlInput ? videoUrlInput.value : '';
                             updateExistingFile(item.id, titleInput.value, descriptionInput.value, mainCheckbox.checked, videoUrl);
                         };
                         
                         const deleteButton = document.createElement('button');
                         deleteButton.className = 'delete-existing-file-btn';
                         deleteButton.innerHTML = 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å';
                         deleteButton.onclick = function() {
                             if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª?')) {
                                 deleteExistingFile(item.id);
                             }
                         };
                         
                         actionsContainer.appendChild(updateButton);
                         actionsContainer.appendChild(deleteButton);
                         
                         // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                         titleInputContainer.appendChild(titleLabel);
                         titleInputContainer.appendChild(titleInput);
                         
                         descriptionInputContainer.appendChild(descriptionLabel);
                         descriptionInputContainer.appendChild(descriptionInput);
                         
                         fileInfo.appendChild(name);
                         fileInfo.appendChild(order);
                         fileInfo.appendChild(titleInputContainer);
                         fileInfo.appendChild(descriptionInputContainer);
                         if (thumbnailInputContainer) {
                             fileInfo.appendChild(thumbnailInputContainer);
                         }
                         fileInfo.appendChild(fileNamePreview);
                         fileInfo.appendChild(mainCheckboxContainer);
                         fileInfo.appendChild(actionsContainer);
                         
                         existingFileItem.appendChild(preview);
                         existingFileItem.appendChild(fileInfo);
                         existingFilesGrid.appendChild(existingFileItem);
                     });
                     
                     contentList.appendChild(existingFilesGrid);
                 } else {
                     contentList.innerHTML = '<div class="no-content">–ù–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>';
                 }
             })
             .catch(error => {
                 console.error('Error loading content:', error);
                 contentList.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ' + error.message + '</div>';
             });
     }
    
         // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
     fileInput.addEventListener('change', displaySelectedFiles);
     
     
     
     // Drag & Drop
     uploadArea.addEventListener('dragover', function(e) {
         e.preventDefault();
         this.classList.add('dragover');
     });
     
     uploadArea.addEventListener('dragleave', function(e) {
         e.preventDefault();
         this.classList.remove('dragover');
     });
     
     uploadArea.addEventListener('drop', function(e) {
         e.preventDefault();
         this.classList.remove('dragover');
         fileInput.files = e.dataTransfer.files;
         displaySelectedFiles();
     });
    
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    document.getElementById('save-content').addEventListener('click', function() {
        if (!selectedObjectId) {
            showMessage('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç', 'error');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
        const hasNewFiles = fileInput.files.length > 0;
        const hasVideoUrl = contentTypeSelect.value === 'video' && document.getElementById('video-url').value.trim() !== '';
        
        // –î–ª—è –≤–∏–¥–µ–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏, –Ω–µ —Ñ–∞–π–ª—ã
        if (contentTypeSelect.value === 'video' && hasNewFiles) {
            showMessage('–î–ª—è –≤–∏–¥–µ–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube/Rutube. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.', 'error');
            return;
        }
        
        if (!hasNewFiles && !hasVideoUrl) {
            showMessage('–î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            return;
        }
        
        const formData = new FormData();
        formData.append('content_type', contentTypeSelect.value);
        formData.append('category', categorySelect.value);
        formData.append('object_id', selectedObjectId);
        
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
        const fileData = [];
        for (let i = 0; i < fileInput.files.length; i++) {
            const titleInput = document.querySelector(`.file-title-input[data-index="${i}"]`);
            const descriptionInput = document.querySelector(`.file-description-input[data-index="${i}"]`);
            
            const title = titleInput ? titleInput.value : '';
            const description = descriptionInput ? descriptionInput.value : '';
            const transliteratedTitle = title ? transliterate(title) : '';
            
            fileData.push({
                title: title,
                description: description,
                transliteratedTitle: transliteratedTitle
            });
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–ª–∞–≤–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ —á–µ–∫–±–æ–∫—Å–æ–≤
        const mainCheckboxes = document.querySelectorAll('.main-checkbox:checked');
        const mainFileIndex = mainCheckboxes.length > 0 ? parseInt(mainCheckboxes[0].dataset.index) : -1;
        
        if (contentTypeSelect.value === 'video') {
            formData.append('video_url', document.getElementById('video-url').value);
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤–∏–¥–µ–æ
            formData.append('description', '–í–∏–¥–µ–æ –∏–∑ YouTube');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã —Å –∏—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        for (let i = 0; i < fileInput.files.length; i++) {
            const file = fileInput.files[i];
            const fileInfo = fileData[i];
            
            formData.append('files', file);
            formData.append(`titles`, fileInfo.title);
            formData.append(`descriptions`, fileInfo.description);
            formData.append(`transliterated_titles`, fileInfo.transliteratedTitle);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –≥–ª–∞–≤–Ω—ã–º
            const isMain = (i === mainFileIndex);
            formData.append(`is_main_${i}`, isMain);
        }
        
        fetch('/admin/main/gallery/save-content/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
                 .then(data => {
             if (data.success) {
                 showMessage('–ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                 loadExistingContent();
                 // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                 fileInput.value = '';
                 document.getElementById('video-url').value = '';
                 selectedFiles.style.display = 'none';
             } else {
                 showMessage(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
             }
         })
        .catch(error => {
            showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
        });
    });
    
    function showMessage(text, type) {
        const message = document.createElement('div');
        message.className = type;
        message.textContent = text;
        messages.appendChild(message);
        
        setTimeout(() => {
            message.remove();
        }, 5000);
    }
    
         // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞
     function updateExistingFile(fileId, title, description, isMain, videoUrl = '') {
         const formData = new FormData();
         formData.append('file_id', fileId);
         formData.append('title', title);
         formData.append('description', description);
         formData.append('is_main', isMain);
         formData.append('video_url', videoUrl);
         formData.append('category', categorySelect.value);
         formData.append('object_id', selectedObjectId);
         
         // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –µ—Å—Ç—å
         const thumbnailInput = document.querySelector(`input[data-id="${fileId}"].file-thumbnail-input`);
         if (thumbnailInput && thumbnailInput.files.length > 0) {
             const file = thumbnailInput.files[0];
             
             // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
             if (!file.type.startsWith('image/')) {
                 showMessage('–ü—Ä–µ–≤—å—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º', 'error');
                 return;
             }
             
             // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 5MB)
             if (file.size > 5 * 1024 * 1024) {
                 showMessage('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—å—é –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB', 'error');
                 return;
             }
             
             formData.append('video_thumbnail', file);
             console.log('Adding video thumbnail:', file.name, 'Size:', file.size, 'Type:', file.type);
         }
         
         fetch('/admin/main/gallery/update-content/', {
             method: 'POST',
             body: formData,
             headers: {
                 'X-CSRFToken': getCookie('csrftoken')
             }
         })
         .then(response => {
             if (!response.ok) {
                 throw new Error(`HTTP error! status: ${response.status}`);
             }
             return response.json();
         })
         .then(data => {
             if (data.success) {
                 showMessage('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                 loadExistingContent(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
             } else {
                 console.error('Update error:', data.error);
                 showMessage(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
             }
         })
         .catch(error => {
             console.error('Network error:', error);
             showMessage(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`, 'error');
         });
     }
     
     // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞
     function deleteExistingFile(fileId) {
         const formData = new FormData();
         formData.append('file_id', fileId);
         formData.append('category', categorySelect.value);
         formData.append('object_id', selectedObjectId);
         
         fetch('/admin/main/gallery/delete-content/', {
             method: 'POST',
             body: formData,
             headers: {
                 'X-CSRFToken': getCookie('csrftoken')
             }
         })
         .then(response => response.json())
         .then(data => {
             if (data.success) {
                 showMessage('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', 'success');
                 loadExistingContent(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
             } else {
                 showMessage(data.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
             }
         })
         .catch(error => {
             showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
         });
     }
     
     function getCookie(name) {
         let cookieValue = null;
         if (document.cookie && document.cookie !== '') {
             const cookies = document.cookie.split(';');
             for (let i = 0; i < cookies.length; i++) {
                 const cookie = cookies[i].trim();
                 if (cookie.substring(0, name.length + 1) === (name + '=')) {
                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                     break;
                 }
             }
         }
         return cookieValue;
     }
});
</script>
<style>
.gallery-interface {
    background: var(--body-bg, #f8f9fa);
    border: 1px solid var(--hairline-color, #dee2e6);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    min-height: 100vh;
    overflow: visible;
}

.form-group label {
    font-weight: bold;
    color: var(--body-fg, #333);
}

.objects-list {
    background: var(--body-bg, white);
    border: 1px solid var(--hairline-color, #dee2e6);
    border-radius: 4px;
    max-height: 400px;
    overflow-y: auto;
}

.object-item {
    padding: 10px 15px;
    border-bottom: 1px solid var(--hairline-color, #eee);
    cursor: pointer;
    transition: background-color 0.2s;
    color: var(--body-fg, #333);
}

.object-item:hover {
    background-color: var(--primary-fg, #f8f9fa);
    color: var(--body-fg, #333) !important;
}

.object-item.selected {
    background-color: var(--primary, #007bff);
    color: white !important;
}

.object-item.selected:hover {
    background-color: var(--primary, #0056b3);
    color: white !important;
}

.existing-content {
    background: var(--body-bg, white);
    border: 1px solid var(--hairline-color, #dee2e6);
    border-radius: 4px;
    padding: 15px;
    margin-top: 20px;
}

.content-item {
    display: flex;
    align-items: center;
    gap: 30px;
    padding: 20px;
    border: 1px solid var(--hairline-color, #eee);
    border-radius: 12px;
    margin-bottom: 20px;
    background: var(--body-bg, white);
    transition: box-shadow 0.2s ease;
}

.content-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.content-preview {
    width: 240px;
    height: 180px;
    background: var(--body-bg, #f8f9fa);
    border: 1px solid var(--hairline-color, #ddd);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: var(--body-fg, #666);
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.content-info {
    flex: 1;
}

.content-title {
    font-weight: bold;
    margin-bottom: 4px;
}

.content-meta {
    font-size: 12px;
    color: var(--body-fg, #666);
}

.upload-section {
    background: var(--body-bg, white);
    border: 2px dashed var(--primary, #007bff);
    border-radius: 8px;
    padding: 30px;
    margin-top: 20px;
}

.upload-section h3 {
    text-align: center;
    margin-bottom: 20px;
    color: var(--body-fg, #333);
    font-size: 18px;
    font-weight: bold;
}

#upload-area {
    text-align: center;
    padding: 40px 20px;
    border: 2px dashed var(--primary, #007bff);
    border-radius: 8px;
    background: var(--body-bg, #f8f9ff);
    margin-bottom: 20px;
    transition: all 0.3s ease;
}

#upload-area:hover {
    background: var(--body-bg, #e3f2fd);
    border-color: var(--primary, #0056b3);
}

.upload-section.dragover {
    background-color: var(--primary-fg, #f8f9ff);
    border-color: var(--primary, #0056b3);
}

.upload-input {
    display: none;
}

.upload-label {
    cursor: pointer;
    color: var(--primary, #007bff);
    font-weight: bold;
}

.upload-label:hover {
    color: var(--primary, #0056b3);
}

.video-fields {
    display: none;
}

.video-fields.show {
    display: block;
}

.video-fields .form-group {
    width: 100%;
}

.loading {
    text-align: center;
    padding: 20px;
    color: var(--body-fg, #666);
}

.error {
    color: #dc3545;
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    border-radius: 4px;
    padding: 10px;
    margin: 10px 0;
}

.success {
    color: #155724;
    background: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 4px;
    padding: 10px;
    margin: 10px 0;
}

.button {
    background: var(--primary, #007bff);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
}

.button:hover {
    background: var(--primary, #0056b3);
}

 .button:disabled {
     background: var(--secondary, #6c757d);
     cursor: not-allowed;
 }
 
 .selected-files {
     margin-top: 15px;
     padding: 15px;
     background: var(--body-bg, #f8f9fa);
     border: 1px solid var(--hairline-color, #dee2e6);
     border-radius: 8px;
 }
 
 .selected-files h4 {
     margin: 0 0 15px 0;
     color: var(--body-fg, #333);
     font-size: 16px;
 }
 
   #files-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(560px, 1fr));
      gap: 20px;
  }
 
   .file-item {
      display: flex;
      flex-direction: column;
      background: var(--body-bg, white);
      border: 1px solid var(--hairline-color, #eee);
      border-radius: 12px;
      padding: 20px;
      transition: box-shadow 0.2s ease;
      min-height: 400px;
      position: relative;
  }
 
 .file-item:hover {
     box-shadow: 0 4px 8px rgba(0,0,0,0.1);
 }
 
   .file-preview {
      width: 100%;
      height: 240px;
      background: var(--body-bg, #f8f9fa);
      border: 1px solid var(--hairline-color, #ddd);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: var(--body-fg, #666);
      overflow: hidden;
      margin-bottom: 15px;
  }
 
 .file-info {
     flex: 1;
 }
 
   .file-name {
      font-weight: bold;
      color: var(--body-fg, #333);
      font-size: 16px;
      margin-bottom: 8px;
      word-break: break-word;
  }
  
  .file-size {
      color: var(--body-fg, #666);
      font-size: 14px;
      margin-bottom: 12px;
  }
  
  .file-name-preview {
      color: var(--primary, #007bff);
      font-size: 14px;
      margin-bottom: 15px;
      padding: 8px 12px;
      background: var(--body-bg, #f8f9ff);
      border-radius: 6px;
      border-left: 4px solid var(--primary, #007bff);
  }
 
 .file-name-preview em {
     color: #dc3545;
     font-style: italic;
     font-weight: 500;
 }
 
 .main-checkbox-container {
     display: flex;
     align-items: center;
     gap: 8px;
     margin-bottom: 12px;
     padding: 8px 12px;
     background: var(--body-bg, #f8f9ff);
     border-radius: 6px;
     border: 1px solid var(--primary, #007bff);
 }
 
 .main-checkbox {
     transform: scale(1.2);
     accent-color: var(--primary, #007bff);
     margin: 0;
 }
 
 .main-checkbox-label {
     font-size: 14px;
     font-weight: 500;
     color: var(--primary, #007bff);
     cursor: pointer;
     user-select: none;
     margin: 0;
 }
 
 .main-checkbox-label:hover {
     color: var(--primary, #0056b3);
 }
 
   .delete-file-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      width: 100%;
      margin-top: auto;
  }
 
   .delete-file-btn:hover {
      background: #c82333;
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Ñ–∞–π–ª–æ–≤ */
  .title-input-container,
  .description-input-container {
      margin-bottom: 12px;
  }
  
  .file-field-label {
      display: block;
      font-weight: 600;
      color: var(--body-fg, #333);
      font-size: 14px;
      margin-bottom: 6px;
  }
  
  .file-title-input,
  .file-description-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--hairline-color, #ddd);
      border-radius: 4px;
      font-size: 14px;
      background: var(--body-bg, white);
      color: var(--body-fg, #333);
      box-sizing: border-box;
      transition: border-color 0.2s ease;
  }
  
  .file-title-input:focus,
  .file-description-input:focus {
      outline: none;
      border-color: var(--primary, #007bff);
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
  }
  
     .file-description-input {
       resize: vertical;
       min-height: 60px;
   }
   
   /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ */
   .existing-files-grid {
       display: grid;
       grid-template-columns: repeat(auto-fill, minmax(560px, 1fr));
       gap: 20px;
       margin-top: 20px;
   }
   
   .existing-file-item {
       display: flex;
       flex-direction: column;
       background: var(--body-bg, white);
       border: 1px solid var(--hairline-color, #eee);
       border-radius: 12px;
       padding: 20px;
       transition: box-shadow 0.2s ease;
       min-height: 400px;
       position: relative;
   }
   
   .existing-file-item:hover {
       box-shadow: 0 4px 8px rgba(0,0,0,0.1);
   }
   
   .existing-file-preview {
       width: 100%;
       height: 240px;
       background: var(--body-bg, #f8f9fa);
       border: 1px solid var(--hairline-color, #ddd);
       border-radius: 8px;
       display: flex;
       align-items: center;
       justify-content: center;
       font-size: 48px;
       color: var(--body-fg, #666);
       overflow: hidden;
       margin-bottom: 15px;
   }
   
   .existing-file-info {
       flex: 1;
   }
   
   .existing-file-name {
       font-weight: bold;
       color: var(--body-fg, #333);
       font-size: 16px;
       margin-bottom: 8px;
       word-break: break-word;
   }
   
   .existing-file-order {
       color: var(--body-fg, #666);
       font-size: 14px;
       margin-bottom: 12px;
   }
   
   .existing-file-actions {
       display: flex;
       gap: 10px;
       margin-top: 15px;
   }
   
   .update-file-btn {
       background: var(--primary, #007bff);
       color: white;
       border: none;
       padding: 8px 16px;
       border-radius: 4px;
       font-size: 14px;
       cursor: pointer;
       transition: background-color 0.2s ease;
       flex: 1;
   }
   
   .update-file-btn:hover {
       background: var(--primary, #0056b3);
   }
   
   .delete-existing-file-btn {
       background: #dc3545;
       color: white;
       border: none;
       padding: 8px 16px;
       border-radius: 4px;
       font-size: 14px;
       cursor: pointer;
       transition: background-color 0.2s ease;
       flex: 1;
   }
   
   .delete-existing-file-btn:hover {
       background: #c82333;
   }
   
   .no-content {
       text-align: center;
       padding: 40px;
       color: var(--body-fg, #666);
       font-style: italic;
   }
</style>
{% endblock %}

{% block content %}
<div class="gallery-interface" style="position: relative; z-index: 1;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–µ–π</h2>
        <button id="toggle-view" class="button" style="background: #6c757d;">–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫</button>
    </div>
    
    <div class="gallery-form">
        <div class="form-group">
            <label for="content-type">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</label>
            <select id="content-type">
                <option value="image">–§–æ—Ç–æ</option>
                <option value="video">–í–∏–¥–µ–æ</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="category">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                <option value="residential_complex">–ñ–∏–ª—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã</option>
                <option value="secondary_property">–í—Ç–æ—Ä–∏—á–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                <option value="employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                <option value="company">–ö–æ–º–ø–∞–Ω–∏—è</option>
                <option value="article">–°—Ç–∞—Ç—å–∏</option>
                <option value="special_offer">–ê–∫—Ü–∏–∏</option>
                <option value="office">–û—Ñ–∏—Å—ã</option>
                <option value="employee_video">–í–∏–¥–µ–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</option>
                <option value="residential_video">–í–∏–¥–µ–æ –∂–∏–ª—ã—Ö –∫–æ–º–ø–ª–µ–∫—Å–æ–≤</option>
            </select>
        </div>
    </div>
    
    <div id="objects-container" style="display: none;">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç:</h3>
        <div id="objects-list" class="objects-list"></div>
    </div>
    
    <div id="existing-content" class="existing-content" style="display: none;">
        <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç:</h3>
        <div id="content-list"></div>
    </div>
    
         <div id="upload-section" class="upload-section" style="display: none;">
         <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</h3>
         <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
             üí° <strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç" —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã. 
             –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å" –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –≤—ã—à–µ.
             <br>üìπ <strong>–í–∏–¥–µ–æ:</strong> –î–ª—è –≤–∏–¥–µ–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube/Rutube. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.
         </p>
        
        <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
        <div id="upload-area">
            <input type="file" id="file-input" class="upload-input" multiple accept="image/*">
            <label for="file-input" class="upload-label">
                <i class="fas fa-cloud-upload-alt"></i> –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏—Ö —Å—é–¥–∞
            </label>
        </div>
        
        <div id="selected-files" class="selected-files" style="display: none;">
            <h4>–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
            <div id="files-list"></div>
        </div>
        
                 <!-- –§–æ—Ä–º–∞ —Å –ø–æ–ª—è–º–∏ -->
         <div class="upload-form">
             <div class="form-row">
                 <div id="video-fields" class="video-fields">
                     <div class="form-group">
                         <label for="video-url">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube/Rutube) –∏–ª–∏ iframe –∫–æ–¥:</label>
                         <input type="text" id="video-url" placeholder="https://www.youtube.com/watch?v=... –∏–ª–∏ iframe –∫–æ–¥">
                         <div class="field-hint" style="font-size: 12px; color: #666; margin-top: 4px;">
                             –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: YouTube —Å—Å—ã–ª–∫–∏, Rutube —Å—Å—ã–ª–∫–∏, iframe –∫–æ–¥—ã
                         </div>
                     </div>
                 </div>
             </div>
         </div>
         
                   <button id="save-content" class="button">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</button>
         </div>
     </div>
    
    <div id="messages"></div>
</div>

<!-- –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—à –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
<style>
#result_list {
    display: none !important;
}
.actions {
    display: none !important;
}
.paginator {
    display: none !important;
}

/* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—ã—Å–æ—Ç–µ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ */
#content {
    min-height: 100vh !important;
    overflow: visible !important;
}

#content-main {
    min-height: 100vh !important;
    overflow: visible !important;
}

.results {
    min-height: auto !important;
    overflow: visible !important;
}

/* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ */
body.change-list {
    overflow: visible !important;
}

.module {
    overflow: visible !important;
}

/* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ */
select {
    position: relative;
    z-index: 1000;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
.gallery-interface h2,
.gallery-interface h3 {
    color: var(--body-fg, #333);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ –æ–±—ä–µ–∫—Ç–∞—Ö */
.object-item {
    color: var(--body-fg, #333) !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ content-item */
.content-title {
    color: var(--body-fg, #333) !important;
}

/* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã */
.gallery-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
    width: 100%;
    max-width: none;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

 .form-group select,
 .form-group input[type="text"],
 .form-group input[type="url"],
 .form-group textarea {
     padding: 8px 12px;
     border: 1px solid var(--hairline-color, #ddd);
     border-radius: 4px;
     font-size: 14px;
     background: var(--body-bg, white);
     color: var(--body-fg, #333);
     width: 300px;
     box-sizing: border-box;
 }
 
 .form-group input[type="checkbox"] {
     width: auto;
     margin-top: 5px;
 }

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ */
.upload-form {
    margin-top: 20px;
    padding: 20px;
    background: var(--body-bg, #f8f9fa);
    border: 1px solid var(--hairline-color, #dee2e6);
    border-radius: 8px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-row:last-child {
    margin-bottom: 0;
}

.upload-form .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.upload-form .form-group label {
    font-weight: bold;
    color: var(--body-fg, #333);
    margin-bottom: 4px;
}

.upload-form .form-group input[type="text"],
.upload-form .form-group input[type="url"],
.upload-form .form-group textarea {
    padding: 10px 12px;
    border: 1px solid var(--hairline-color, #ddd);
    border-radius: 4px;
    font-size: 14px;
    background: var(--body-bg, white);
    color: var(--body-fg, #333);
    width: 100%;
    box-sizing: border-box;
    resize: vertical;
}

.upload-form .form-group input[type="checkbox"] {
    width: auto;
    margin-top: 8px;
    transform: scale(1.2);
    margin-left: 0;
}

.upload-form .form-group label[for="is-main"] {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ */
.checkbox-group {
    display: flex;
    align-items: center;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-weight: 500;
    color: var(--body-fg, #333);
    margin: 0;
    transition: color 0.2s ease;
}

.checkbox-label:hover {
    color: var(--primary, #007bff);
}

.checkbox-label input[type="checkbox"] {
    margin: 0;
    transform: scale(1.1);
    accent-color: var(--primary, #007bff);
}

.checkbox-label span {
    margin-left: 0;
    user-select: none;
}

.upload-form .form-group textarea {
    min-height: 80px;
}

/* –°–µ–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
.settings-section {
    margin-top: 20px;
    padding: 15px 20px;
    background: var(--body-bg, #f8f9fa);
    border: 1px solid var(--hairline-color, #e9ecef);
    border-radius: 6px;
    border-left: 4px solid var(--primary, #007bff);
}

.settings-section .checkbox-group {
    margin: 0;
}

.settings-section .checkbox-label {
    font-size: 14px;
    color: var(--body-fg, #495057);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
#save-content {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: bold;
}

/* –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —à–∏—Ä–∏–Ω—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ */
.gallery-interface {
    background: var(--body-bg, #f8f9fa);
    border: 1px solid var(--hairline-color, #dee2e6);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    min-height: 100vh;
    overflow: visible;
    width: 100%;
    max-width: none;
}

/* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω–∫–µ */
#content-main {
    width: 100% !important;
    max-width: none !important;
}

.results {
    width: 100% !important;
    max-width: none !important;
}

 /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
 @media (max-width: 768px) {
     .form-row {
         grid-template-columns: 1fr;
         gap: 15px;
     }
     
     .gallery-form {
         grid-template-columns: 1fr;
         gap: 15px;
     }
     
     .upload-section {
         padding: 20px;
     }
     
     #upload-area {
         padding: 30px 15px;
     }
     
     .upload-form {
         padding: 15px;
     }
     
     #files-list {
         grid-template-columns: 1fr;
         gap: 15px;
     }
     
     .file-item {
         min-height: 300px;
         padding: 15px;
     }
     
     .file-preview {
         height: 180px;
         font-size: 36px;
     }
     
     .file-name {
         font-size: 14px;
     }
     
     .file-size {
         font-size: 12px;
     }
     
           .file-name-preview {
          font-size: 12px;
          padding: 6px 10px;
      }
      
      .main-checkbox-container {
          padding: 6px 10px;
          margin-bottom: 10px;
      }
      
      .main-checkbox-label {
          font-size: 12px;
      }
      
             .delete-file-btn {
           padding: 10px 16px;
           font-size: 14px;
       }
       
       .file-field-label {
           font-size: 12px;
       }
       
       .file-title-input,
       .file-description-input {
           font-size: 12px;
           padding: 6px 10px;
       }
       
               .file-description-input {
            min-height: 50px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ */
        .existing-files-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .existing-file-item {
            min-height: 300px;
            padding: 15px;
        }
        
        .existing-file-preview {
            height: 180px;
            font-size: 36px;
        }
        
        .existing-file-name {
            font-size: 14px;
        }
        
        .existing-file-order {
            font-size: 12px;
        }
        
        .existing-file-actions {
            flex-direction: column;
            gap: 8px;
        }
        
        .update-file-btn,
        .delete-existing-file-btn {
            padding: 10px 16px;
            font-size: 14px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è –ø—Ä–µ–≤—å—é –≤–∏–¥–µ–æ */
        .file-thumbnail-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--hairline-color, #ddd);
            border-radius: 4px;
            font-size: 14px;
            background: var(--body-bg, white);
            color: var(--body-fg, #333);
            box-sizing: border-box;
            transition: border-color 0.2s ease;
        }
        
                 .file-thumbnail-input:focus {
             outline: none;
             border-color: var(--primary, #007bff);
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
         }
         
         .file-video-url-input {
             width: 100%;
             padding: 8px 12px;
             border: 1px solid var(--hairline-color, #ddd);
             border-radius: 4px;
             font-size: 14px;
             background: var(--body-bg, white);
             color: var(--body-fg, #333);
             box-sizing: border-box;
             transition: border-color 0.2s ease;
         }
         
         .file-video-url-input:focus {
             outline: none;
             border-color: var(--primary, #007bff);
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
         }
         
         .video-url-container {
             margin-bottom: 12px;
         }
        
        .current-thumbnail {
            margin-bottom: 8px;
            text-align: center;
        }
        
                 .current-thumbnail img {
             border: 1px solid #ddd;
             border-radius: 4px;
             max-width: 150px;
             max-height: 90px;
         }
        
        .current-thumbnail small {
            display: block;
            margin-top: 4px;
            color: #666;
            font-size: 12px;
        }
        
                 @media (max-width: 768px) {
             .file-thumbnail-input {
                 font-size: 12px;
                 padding: 6px 10px;
             }
             
             .file-video-url-input {
                 font-size: 12px;
                 padding: 6px 10px;
             }
             
                          .current-thumbnail img {
                  max-width: 120px;
                  max-height: 72px;
              }
         }
 }
</style>

{% endblock %}
