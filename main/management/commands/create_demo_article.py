from django.core.management.base import BaseCommand
from django.utils import timezone
from main.models import Article, Tag, Author

class Command(BaseCommand):
    help = 'Создает демонстрационную статью с богатым контентом'

    def handle(self, *args, **options):
        # Создаем или получаем автора
        author, created = Author.objects.get_or_create(
            name='Иваткина Мария',
            defaults={
                'position': 'Эксперт Дирекции финансовой грамотности НИФИ Минфина России',
                'description': 'Специалист по финансовой грамотности с опытом работы более 10 лет. Автор множества статей по ипотеке и финансовому планированию.',
                'articles_count': 281,
                'total_views': 497087,
                'total_likes': 9375
            }
        )

        # Создаем или получаем теги
        tags = []
        tag_names = ['Ипотека', 'Кредиты', 'Доходы и налоги', 'Ситуация', 'Экономика']
        for tag_name in tag_names:
            tag, created = Tag.objects.get_or_create(name=tag_name)
            tags.append(tag)

        # Создаем демонстрационную статью
        article_data = {
            'title': 'Как взять ипотеку без первоначального взноса в 2025 году',
            'excerpt': 'Сегодня большинство банков требуют не менее 15-20% от стоимости жилья в качестве первоначального взноса по ипотеке. Однако существуют программы, позволяющие получить ипотечный кредит без первоначального взноса.',
            'content': '''
<h2>Что такое первоначальный взнос?</h2>
<p>Первоначальный взнос — это часть стоимости недвижимости, которую заемщик должен внести из собственных средств. Обычно банки требуют от 15% до 30% от стоимости жилья.</p>

<p>Первоначальный взнос выполняет несколько важных функций:</p>
<ul>
    <li>Снижает риски банка</li>
    <li>Демонстрирует платежеспособность заемщика</li>
    <li>Уменьшает ежемесячный платеж</li>
    <li>Снижает общую переплату по кредиту</li>
</ul>

<h2>Ипотека без первоначального взноса</h2>
<p>В 2025 году доступны несколько программ ипотечного кредитования без первоначального взноса:</p>

<h3>1. Семейная ипотека</h3>
<p>Программа для семей с детьми, где государство компенсирует часть первоначального взноса. Условия программы:</p>
<ul>
    <li>Ставка от 5.5% годовых</li>
    <li>Сумма кредита до 12 млн рублей</li>
    <li>Срок кредитования до 30 лет</li>
    <li>Требуется наличие детей</li>
</ul>

<h3>2. Ипотека для IT-специалистов</h3>
<p>Специальная программа для работников IT-сферы с льготными условиями:</p>
<ul>
    <li>Ставка от 4.5% годовых</li>
    <li>Возможность кредитования без первоначального взноса</li>
    <li>Упрощенная процедура одобрения</li>
</ul>

<h3>3. Военная ипотека</h3>
<p>Программа для военнослужащих с использованием накопительно-ипотечной системы:</p>
<ul>
    <li>Государственное финансирование</li>
    <li>Не требует первоначального взноса</li>
    <li>Льготные условия кредитования</li>
</ul>

<h2>Чем еще можно заменить первоначальный взнос?</h2>
<p>Если у вас нет возможности внести первоначальный взнос деньгами, рассмотрите альтернативные варианты:</p>

<h3>1. Материнский капитал</h3>
<p>Средства материнского капитала можно использовать для первоначального взноса по ипотеке. Это особенно актуально для семей с детьми.</p>

<h3>2. Продажа имеющейся недвижимости</h3>
<p>Если у вас есть другая недвижимость, вы можете продать её и использовать вырученные средства для первоначального взноса.</p>

<h3>3. Помощь родственников</h3>
<p>Многие банки принимают в качестве первоначального взноса средства, подаренные родственниками. Важно правильно оформить дарственную.</p>

<h3>4. Кредит под залог</h3>
<p>Можно взять потребительский кредит под залог имеющегося имущества и использовать его для первоначального взноса.</p>

<h2>Плюсы и минусы ипотеки без первоначального взноса</h2>

<h3>Преимущества:</h3>
<ul>
    <li>Возможность приобрести жилье без накоплений</li>
    <li>Быстрое решение жилищного вопроса</li>
    <li>Доступность для молодых семей</li>
    <li>Возможность инвестировать в недвижимость</li>
</ul>

<h3>Недостатки:</h3>
<ul>
    <li>Более высокие процентные ставки</li>
    <li>Большие ежемесячные платежи</li>
    <li>Высокая общая переплата</li>
    <li>Риски при падении цен на недвижимость</li>
    <li>Сложности при рефинансировании</li>
</ul>

<h2>Как выбрать подходящую программу</h2>
<p>При выборе программы ипотечного кредитования без первоначального взноса учитывайте следующие факторы:</p>

<ol>
    <li><strong>Процентная ставка</strong> — чем ниже, тем лучше</li>
    <li><strong>Сумма кредита</strong> — должна покрывать стоимость желаемого жилья</li>
    <li><strong>Срок кредитования</strong> — влияет на размер ежемесячного платежа</li>
    <li><strong>Требования к заемщику</strong> — возраст, доход, стаж работы</li>
    <li><strong>Дополнительные расходы</strong> — страховка, оценка, нотариус</li>
</ol>

<h2>Подготовка документов</h2>
<p>Для получения ипотеки без первоначального взноса потребуются следующие документы:</p>

<table>
    <thead>
        <tr>
            <th>Документ</th>
            <th>Описание</th>
            <th>Срок действия</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Паспорт</td>
            <td>Основной документ заемщика</td>
            <td>Бессрочно</td>
        </tr>
        <tr>
            <td>Справка о доходах</td>
            <td>Форма 2-НДФЛ или справка по форме банка</td>
            <td>3 месяца</td>
        </tr>
        <tr>
            <td>Трудовая книжка</td>
            <td>Подтверждение стажа работы</td>
            <td>Актуальная</td>
        </tr>
        <tr>
            <td>Свидетельство о браке</td>
            <td>Если заемщик состоит в браке</td>
            <td>Бессрочно</td>
        </tr>
        <tr>
            <td>Свидетельства о рождении детей</td>
            <td>Для семейных программ</td>
            <td>Бессрочно</td>
        </tr>
    </tbody>
</table>

<h2>Заключение</h2>
<p>Ипотека без первоначального взноса — это реальная возможность приобрести собственное жилье даже при отсутствии значительных накоплений. Однако важно тщательно изучить все условия кредитования и оценить свои финансовые возможности.</p>

<blockquote>
    <p>Помните, что ипотека — это долгосрочное обязательство, которое может длиться 20-30 лет. Принимайте решение взвешенно, учитывая не только текущую ситуацию, но и возможные изменения в будущем.</p>
</blockquote>

<p>Перед оформлением ипотеки обязательно проконсультируйтесь с финансовым консультантом и сравните предложения нескольких банков. Это поможет найти наиболее выгодные условия кредитования.</p>
            ''',
            'category': 'mortgage',
            'is_featured': True,
            'published_date': timezone.now().date(),
            'views_count': 11464,
            'likes_count': 24,
            'comments_count': 3,
            'author': author,
            'tags': tags
        }

        # Создаем или обновляем статью
        article_data_copy = article_data.copy()
        tags = article_data_copy.pop('tags')  # Убираем теги из defaults
        
        article, created = Article.objects.get_or_create(
            title=article_data['title'],
            defaults=article_data_copy
        )

        if not created:
            # Обновляем существующую статью
            for key, value in article_data.items():
                if key != 'tags':
                    setattr(article, key, value)
            article.save()

        # Добавляем теги
        article.tags.set(tags)

        if created:
            self.stdout.write(
                self.style.SUCCESS(f'Создана демонстрационная статья: "{article.title}"')
            )
        else:
            self.stdout.write(
                self.style.WARNING(f'Обновлена демонстрационная статья: "{article.title}"')
            )

        self.stdout.write(
            self.style.SUCCESS('Демонстрационная статья готова!')
        ) 