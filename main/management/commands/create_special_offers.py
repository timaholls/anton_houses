from django.core.management.base import BaseCommand
from django.utils import timezone
from datetime import timedelta
from main.models import SpecialOffer, ResidentialComplex
import random


class Command(BaseCommand):
    help = '–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è'

    def add_arguments(self, parser):
        parser.add_argument(
            '--count',
            type=int,
            default=10,
            help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è'
        )
        parser.add_argument(
            '--expire-days',
            type=int,
            default=30,
            help='–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)'
        )

    def handle(self, *args, **options):
        count = options['count']
        expire_days = options['expire_days']
        
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∂–∏–ª—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã
        complexes = list(ResidentialComplex.objects.all())
        
        if not complexes:
            self.stdout.write(
                self.style.ERROR('–ù–µ—Ç –∂–∏–ª—ã—Ö –∫–æ–º–ø–ª–µ–∫—Å–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∂–∏–ª—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã.')
            )
            return
        
        self.stdout.write(f'–°–æ–∑–¥–∞—é {count} —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π...')
        
        # –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
        offers_data = [
            {
                'title': '–°–∫–∏–¥–∫–∞ 15% –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –ñ–ö',
                'description': '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –°–∫–∏–¥–∫–∞ 15% –Ω–∞ –≤—Å–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –£—Å–ø–µ–π—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.'
            },
            {
                'title': '–ò–ø–æ—Ç–µ–∫–∞ –æ—Ç 5.5% –≥–æ–¥–æ–≤—ã—Ö',
                'description': '–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∏–ø–æ—Ç–µ—á–Ω–æ–º—É –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—é! –°—Ç–∞–≤–∫–∞ –æ—Ç 5.5% –≥–æ–¥–æ–≤—ã—Ö –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –Ω–∞—à–µ–º –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å –æ—Ç 10%.'
            },
            {
                'title': '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ - –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ –ø–æ–¥ –∫–ª—é—á! –î–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç, –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ä–∞–±–æ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å. –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 500 000 —Ä—É–±–ª–µ–π.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ –ø–∞—Ä–∫–æ–≤–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É 50% –Ω–∞ –ø–∞—Ä–∫–æ–≤–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ø–æ–¥–∑–µ–º–Ω–æ–º –ø–∞—Ä–∫–∏–Ω–≥–µ. –£–¥–æ–±–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞ –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ.'
            },
            {
                'title': '–†–∞—Å—Å—Ä–æ—á–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç',
                'description': '–†–∞—Å—Å—Ä–æ—á–∫–∞ –Ω–∞ 12 –º–µ—Å—è—Ü–µ–≤ –±–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç! –ü–æ–∫—É–ø–∞–π—Ç–µ –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É –∏ –Ω–µ –ø–µ—Ä–µ–ø–ª–∞—á–∏–≤–∞–π—Ç–µ. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å –≤—Å–µ–≥–æ 30% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏.'
            },
            {
                'title': '–ü–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ - –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –≤—ã–±–æ—Ä: –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞, –º–µ–±–µ–ª—å –∏–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ —Ä–µ–º–æ–Ω—Ç. –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–∞—Ä–∫–∞ –¥–æ 200 000 —Ä—É–±–ª–µ–π.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ –¥–≤—É—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
                'description': '–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å–µ –¥–≤—É—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–µ–º—å–∏. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.'
            },
            {
                'title': '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –Ω–∞—à–µ–º –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ - –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ñ–æ—Ä–º–ª—è–µ–º –∑–∞ –≤–∞—Å. –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 50 000 —Ä—É–±–ª–µ–π.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ —Å—Ç—É–¥–∏–∏',
                'description': '–°–∫–∏–¥–∫–∞ 25% –Ω–∞ –≤—Å–µ —Å—Ç—É–¥–∏–∏ –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ! –û—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –∏–ª–∏ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏. –í—ã–≥–æ–¥–Ω–∞—è —Ü–µ–Ω–∞ –∏ –±—ã—Å—Ç—Ä–∞—è –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å.'
            },
            {
                'title': '–°–µ–º–µ–π–Ω–∞—è —Å–∫–∏–¥–∫–∞',
                'description': '–°–µ–º–µ–π–Ω–∞—è —Å–∫–∏–¥–∫–∞ 10% –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã —Å–µ–º—å–µ–π —Å –¥–µ—Ç—å–º–∏. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏ –Ω–∞ –¥–µ—Ç—Å–∫—É—é –º–µ–±–µ–ª—å.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
                'description': '–°–∫–∏–¥–∫–∞ –¥–æ 30% –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ! –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ. –£—Å–ø–µ–π—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ.'
            },
            {
                'title': '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —é—Ä–∏—Å—Ç–∞',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã - –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —é—Ä–∏—Å—Ç–∞ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –ü–æ–º–æ–∂–µ–º –æ—Ñ–æ—Ä–º–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ —Ç—Ä–µ—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã',
                'description': '–°–∫–∏–¥–∫–∞ 18% –Ω–∞ –≤—Å–µ —Ç—Ä–µ—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –ü—Ä–æ—Å—Ç–æ—Ä–Ω–æ–µ –∂–∏–ª—å–µ –¥–ª—è –±–æ–ª—å—à–æ–π —Å–µ–º—å–∏ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ.'
            },
            {
                'title': '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –º–µ–±–µ–ª–∏',
                'description': '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã - –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞ –º–µ–±–µ–ª–∏. –ü–æ–º–æ–∂–µ–º –æ–±—É—Å—Ç—Ä–æ–∏—Ç—å –≤–∞—à–µ –Ω–æ–≤–æ–µ –∂–∏–ª—å–µ. –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥–∏ –¥–æ 100 000 —Ä—É–±–ª–µ–π.'
            },
            {
                'title': '–°–∫–∏–¥–∫–∞ –Ω–∞ –ø–µ–Ω—Ç—Ö–∞—É—Å—ã',
                'description': '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Å–∫–∏–¥–∫–∞ 15% –Ω–∞ –ø–µ–Ω—Ç—Ö–∞—É—Å—ã –≤ –∂–∏–ª–æ–º –∫–æ–º–ø–ª–µ–∫—Å–µ. –ü—Ä–µ–º–∏–∞–ª—å–Ω–æ–µ –∂–∏–ª—å–µ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.'
            }
        ]
        
        created_count = 0
        
        for i in range(min(count, len(offers_data))):
            offer_data = offers_data[i].copy()
            
            # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å
            complex_obj = random.choice(complexes)
            
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –∏—Å—Ç–µ—á–µ–Ω–∏—è
            expires_at = timezone.now() + timedelta(days=expire_days)
            
            # –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
            offer = SpecialOffer.objects.create(
                residential_complex=complex_obj,
                title=offer_data['title'],
                description=offer_data['description'],
                is_active=True,
                priority=random.randint(1, 10),
                expires_at=expires_at
            )
            
            created_count += 1
            self.stdout.write(
                f'‚úÖ –°–æ–∑–¥–∞–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: "{offer.title}" '
                f'(–ñ–ö: {offer.residential_complex.name}, '
                f'–∏—Å—Ç–µ–∫–∞–µ—Ç: {offer.expires_at.strftime("%d.%m.%Y")})'
            )
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        active_offers = SpecialOffer.objects.filter(is_active=True).count()
        expired_offers = SpecialOffer.objects.filter(is_active=False).count()
        
        self.stdout.write(
            self.style.SUCCESS(
                f'\nüéâ –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!\n'
                f'–°–æ–∑–¥–∞–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {created_count}\n'
                f'–í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {active_offers}\n'
                f'–í—Å–µ–≥–æ –∏—Å—Ç–µ–∫—à–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: {expired_offers}\n'
                f'\n–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ {expire_days} –¥–Ω–µ–π.'
            )
        )
